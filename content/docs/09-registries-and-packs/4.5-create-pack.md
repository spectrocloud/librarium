---
title: 'Deploy a Custom Add-On Pack'
metaTitle: 'Deploy a Custom Add-On Pack'
metaDescription: 'How to create an add-on pack using the manifest files or Helm charts in Spectro Cloud.'
icon: ''
hideToC: true
fullWidth: false
---

import Tabs from 'shared/components/ui/Tabs';
import WarningBox from 'shared/components/WarningBox';
import InfoBox from 'shared/components/InfoBox';
import PointsOfInterest from 'shared/components/common/PointOfInterest';
import Tooltip from "shared/components/ui/Tooltip";


# Create and Deploy a Custom Add-On Pack
Custom add-on packs enable running desired Kubernetes applications in clusters and reusing them in multiple deployments, ensuring uniformity across the infrastructure. The primary use cases for creating custom packs are:

- Aggregating all required configuration and application dependencies for simplified deployment and consumption.

- Open-source contributors can add new Kubernetes applications to a custom add-on pack for the community.

- Enterprises can add proprietary Kubernetes applications to a custom add-on pack.

In this tutorial, you will create a custom add-on pack to package a sample Kubernetes application, [Hello Universe](https://github.com/spectrocloud/hello-universe#hello-universe), and deploy that application to a cluster. You will learn to create the pack in two ways, using the manifest files and Helm charts. 

After defining the custom pack, you will set up a registry server, publish the pack to that registry, and configure the registry server in Palette. Lastly, you will create a cluster profile comprising your custom pack and deploy it to a cluster using either Palette or Terraform.  


# Prerequisites
To complete the tutorial, you will need the following items:

1. A Spectro Cloud account. Visit [https://console.spectrocloud.com](https://console.spectrocloud.com) to create an account.


2. Tenant admin access to Palette for the purpose of adding a new registry server.


3. A cloud account, either of AWS, Azure, or GCP, added to your Palette project settings. 


4. An SSH key created in either of the AWS, Azure, or GCP region where you will deploy the cluster.


5. [Docker Desktop](https://docs.docker.com/get-docker/) installed on your local machine to start the tutorials container. 


6. Basic knowledge of Docker containers and Kubernetes manifest file attributes.




# Set up the Tutorial Environment
You will work in a Docker container pre-configured with the necessary tools for this tutorial. However, you can practice this tutorial in any other environment having  `linux/amd64` or `x86_64` processor architecture by installing the [necessary tools](https://github.com/spectrocloud/tutorials/blob/main/docs/docker.md#docker) and cloning the [GitHub repository](https://github.com/spectrocloud/tutorials/) containing the tutorial files. Here are the steps to start the tutorials container. 
<br />

  - Start the Docker Desktop on your local machine and ensure the daemon is available by issuing a command to list the running containers.
  <br />

  ```bash
  docker ps
  ```

  - Download the `ghcr.io/spectrocloud/tutorials:1.0.3` image to your local machine. The Docker image includes the necessary tools. 
  <br />
  
  ```bash
  docker pull ghcr.io/spectrocloud/tutorials:1.0.3
  ```

  - Next, start the container, and open a bash session into it.
  <br />
  
  ```bash
  docker run --name tutorialContainer --publish 7000:5000 --interactive --tty ghcr.io/spectrocloud/tutorials:1.0.3 bash
  ```

  If the port 7000 on your local machine is unavailable, you can use any other port of your choice. 
  <br /> 

  <InfoBox>
  Wait to exit the container until the tutorial is complete. Otherwise, you may lose your progress. 
  </InfoBox>



## Tools and Starter Code
After opening a bash session in the active container, verify that the tools necessary for this tutorial are installed already. 
<br />

  - Check the Spectro CLI version.
  <br />

  ```bash
  spectro version
  ```

  - Check the Spectro registry server version.
  <br />

  ```bash
  registry --version
  ```

  - Check Terraform version.
  <br />

  ```bash
  terraform --version
  ```

  In addition to the tools above, the tutorials container has other tools, such as `ngrok`, `git`, and `nano`. 
  
  - Look at the directories relevant to the current tutorial in the **root** directory. 
  <br />

  ```bash
  .
  ├── packs
  │   └── hello-universe-pack             # Contains the pack files
  └── terraform
      └── pack-tf                         # Contains the .tf files for creating Spectro Cloud resources
  ```
  The **packs** directory contains the pack files, whereas the **terraform** directory contains the Terraform files for creating Spectro Cloud resources, which you will utilize in the latter half of this tutorial.


# Build a Pack

Building a custom pack requires defining specific files. 
As outlined in the [Adding Add-on Packs](/registries-and-packs/adding-add-on-packs), you can define a custom pack in two ways, either using manifest files or Helm charts. Accordingly, the file structure varies for manifest-based packs and Helm chart-based packs. Here is the reference file structure:
<br />

<Tabs>

<Tabs.TabPane tab="Manifests-based pack" key="add_on_packs_manifests">

<br />

```bash
.
├── pack.json           # mandatory
├── values.yaml         # mandatory
├── manifests           # mandatory
    ├── manifest-1.yaml
    ├── manifest-2.yaml
│   └── manifest-3.yaml
├── logo.png            # mandatory
├── schema.yaml         # Optional
└── README.md           # Optional
```

</Tabs.TabPane>

<Tabs.TabPane tab="Helm charts-based pack" key="add_on_packs_helm_charts">

<br />

```bash
.
├── pack.json           # mandatory
├── values.yaml         # mandatory
├── charts              # mandatory. 
│   ├── chart-1         # Can have nested charts
│   │   ├── Chart.yaml
│   │   ├── templates
│   │   │   ├── template-1.yaml
│   │   │   └── template-2.yaml
│   │   └── values.yaml # This values.yaml will constitute the pack-level values.yaml file. 
│   ├── chart-1.tgz
│   ├── chart-2
│   │   ├── Chart.yaml
│   │   ├── templates
│   │   │   ├── template-1.yaml
│   │   │   └── template-2.yaml
│   │   └── values.yaml # This values.yaml will constitute the pack-level values.yaml file. 
│   └── chart-2.tgz
├── logo.png            # mandatory
├── schema.yaml         # Optional
└── README.md           # Optional
```


</Tabs.TabPane>


</Tabs>

<br /> <br />

To simplify this tutorial, we have provided you with the manifest file for the *Hello Universe* application in the **packs/hello-universe-pack** folder. Change the directory to the **packs/hello-universe-pack** folder.
<br />

```bash
cd packs/hello-universe-pack
```
Ensure you have the following files in the current directory.
<br />

```bash
.
├── pack.json           # mandatory
├── values.yaml         # mandatory
├── manifests           # mandatory
│   └── hello-universe.yaml
├── logo.png            # mandatory
└── README.md           # Optional
```
<br /> <br />

## Pack File Structure

Go ahead and review each file in the pack.
<br />

1. **pack.json** -  This file contains the pack metadata, such as `addonType`, `cloudTypes`, `kubeManifests` array containing the list of manifest files, `layer`, `name`, and `version`. Refer to the [JSON Schema](/registries-and-packs/add-custom-packs) for a list of attributes and respective data types. The schema validation will happen when you push a pack to the registry.  

  <br /> 

  ```json
  {
      "addonType":"app services",
      "cloudTypes": [ "all" ],
      "displayName": "Hello Universe",
      "kubeManifests": [
          "manifests/hello-universe.yaml"
      ],
      "layer": "addon",
      "name": "hellouniverse",
      "version": "1.0.0"
  }
  ```
  
  <br />



2. **values.yaml** -  This file contains configurable parameters you can define while adding the current pack to a cluster profile. In the **values.yaml** file for this tutorial, the `pack/namespace` attribute specifies the namespace on the target cluster to deploy the pack. If the namespace is not found, Palette will create a new namespace with the name specified. 
  
  The `manifests` section exposes the configurable parameters for each manifest file in the **manifests** directory. For example, in the sample code snippet below, the `hello-universe` attribute exposes the `registry`, `repository`, and `tag` parameters. 
  <br /> <br />

  ```yaml
  pack:
      namespace: "hello-universe"
  manifests:
      hello-universe:
          registry: ghcr.io
          repository: spectrocloud/hello-universe
          tag: 1.0.10
  ```

  <br />

  In addition, you can optionally define *presets*, the predefined values, to use in the **values.yaml**, in a separate **presets.yaml** file. The presets will become available during the cluster profile creation. Presets make the parameter configuration effortless and less error-prone by avoiding manually editing the **values.yaml** file. Refer [here](/registries-and-packs/pack-constraints) for more details and examples on defining presets. 
  
  For example, the visual below shows the **values.yaml** file's configurable parameters for the `hello-universe` manifest during the cluster profile creation. 

  <br />

  ![Visual of the configurable parameters in the values.yaml file.](/tutorials/create-pack/registries-and-packs_create-pack_profile-values-yaml.png )

  <br /> <br />

3. **manifests** -  This directory contains the manifest files for your Kubernetes application. This tutorial has only one file, **hello-universe.yaml**. Note that the **values.yaml** file has a corresponding `manifests/hello-universe` element with the same name as the YAML file. 
  <br />

4. **logo.png** -  This file has a logo that Palette will display during the cluster profile creation.  
<br />


5. **README.md** -  This file may contain the pack description, purpose, authors, and other relevant information. The README in the current example, introduces the application used in the pack.
<br />


After finalizing all files in the pack directory, the next step is to set up a registry server and publish the pack to that registry, where you can access it directly from Palette. 

<br /> <br />

# Set Up the Registry Server

The tutorials environment already has the Spectro registry service and other necessary tools available. The sections ahead will guide you to start the registry server, expose the service to the external world using [Ngrok](https://ngrok.com/) reverse proxy, and log in to the registry server to push your custom add-on pack to it.   

## Start and Expose the Registry Server
Start the registry server by issuing the following command from the tutorials container bash session. 
<br />

```bash
registry serve /etc/spectro/config.yml > /var/log/registry.log 2>&1 &
```

The registry server will start in HTTP mode (not HTTPS). Refer to the [Add a Custom Registry](/registries-and-packs/adding-a-custom-registry) to know more about deploying an HTTPS registry server. 


Next, expose the registry server to the public so that you can configure the registry server in Palette later. Use Ngrok reverse proxy to expose the registry server listening on port 5000 via an HTTP tunnel using the following command. 
<br />

```bash
ngrok http 5000 --log-level debug
```

The command above will reserve the current bash session and display the status of each HTTP request made to the Ngrok server later in this tutorial. The visual below shows the registry server successfully exposed via Ngrok.  

<br />

![Visual of registry server exposed via ngrok](/tutorials/create-pack/registries-and-packs_create-pack_ngrok-start.png )

<br /> <br />

Verify the registry server is accessible from outside the tutorials container by visiting the `/health` endpoint. Access the *https://3735-106-215-88-147.ngrok-free.app/health*in your host browser. Replace the base URL with the Ngrok URL output you received.  You should receive a `{"status":"UP"}` response.

<br /> 

## Log in to the Registry Server
Once the registry server is up and running, the next step is to log in and then push the pack to it. The pack to push is present within the tutorials container; therefore, open up another bash session in the tutorials container from your local terminal.  
<br/>

```bash
docker exec -it tutorialContainer bash
```

Login to the registry server using Ngrok's public URL assigned to you. Issue the following but replace the URL with your Ngrok URL. 
<br/>

```bash
spectro registry login f59e-49-36-220-143.ngrok-free.app --insecure --default --user admin --password admin
```

<WarningBox>

Do not use https:// or http:// keyword in the Ngrok URL. Otherwise, you will encounter an authorization issue. 

</WarningBox>

The command above uses the following credentials to log in to the registry server.
<br />

```bash
username: admin
password: admin
```

You will receive a `Login Succeeded` response, if the login succeeds. 
<br />


## Push the Pack to the Registry Server
Once you are logged in, push the pack to the registry server using the following command. 
<br />

```bash
spectro pack push /packs/hello-universe-pack/
```

You can verify that the pack is in the registry by using the list command. The list command lists all packs in the registry. 
<br />

```bash
spectro pack ls
```

Ensure that the command above displays the recent pack you pushed, as shown in the visual below.  

<br />

![Visual of spectro pack ls](/tutorials/create-pack/registries-and-packs_create-pack_pack-push.png)

<br /> <br />
If you need help with the Spectro CLI commands, such as deleting a pack, refer to the [Spectro CLI commands](/registries-and-packs/spectro-cli-reference#commands). 

## Configure the Registry Server in Palette
After pushing the pack to the registry server, log in to Palette and configure the registry service so that you can access the registry service while creating a cluster profile.   


Log in to Palette, and switch to the Tenant admin view.
<br />

![Visual of Palette Tenant admin settings.](/tutorials/create-pack/registries-and-packs_create-pack_tenant-admin.png)

<br /> <br />


As a Tenant admin, navigate to **Admin Settings** > **Registries** > **Pack Registries** section. Click on **Add New Pack Registry** and enter the pack registry name, endpoint URL, and user credentials. For a consistent experience in this tutorial, use the name **private-pack-registry**, as shown in the visual below. Though you can choose any other name of your choice. Ensure you replace the URL with your Ngrok URL and click on **Confirm** to add the registry server.

<br />

![Visual of registry server edit option in Palette Tenant admin settings.](/tutorials/create-pack/registries-and-packs_create-pack_registry-edit.png)

<br /> <br />


Palette syncs the registry server periodically. However, you can sync it manually first time by clicking the **three-dot Menu** against the registry server name and selecting the **Sync** option.  

<br />

![Visual of registry server sync in Palette](/tutorials/create-pack/registries-and-packs_create-pack_registry-sync.png)

<br /> <br />


# Create a Cluster Profile and Deploy a Cluster

As part of this tutorial, you will create a cluster profile for AWS. However, you can choose any other cloud service provider, provided the following two items are configured:
<br /> 

1. **Cloud account**: A cloud account added to your Palette project settings. 

  The AWS cloud account name in this tutorial example is **spectro-cloud**. You can choose any name of your choice. The below visual shows how to add and verify AWS cloud account to your project by navigating to **Project Settings** > **Cloud Accounts** > **AWS** > **Add AWS Account** in Palette.

<br />

![Visual of Cloud Accounts in Palette.](/tutorials/create-pack/registries-and-packs_create-pack_palette-cloud-account.png)

<br /> <br />


2. **SSH key**: An SSH key created in the region where you will deploy the cluster. 

  This tutorial example will deploy the cluster in the **us-east-2**  region, and the SSH key name used in this example is **aws_key_sk_us_east_2**. You must choose the desired region and the available SSH key name from your AWS account. 

<br /> 
Create a cluster profile and deploy it to a cluster using either of the following two methods:

1. Using Palette.


2. Using Terraform code.
<br /> <br /> 

<Tabs>

<Tabs.TabPane tab="Palette" key="palette_console">


## Create a Cluster Profile
Switch to the **Default** project scope for creating a cluster profile.  
<br />

![Visual of the Palette Default scope.](/tutorials/create-pack/registries-and-packs_create-pack_default-scope.png)

<br /> <br />

Select the **Profile** section in the left **Main Menu** to create a cluster profile that will combine the core infrastructure and add-on layers. Click on the **Add Cluster Profile** button, and provide the details in the wizard that follows. The wizard will present you with the following sections. 
<br />

### Basic Information
Use the following values in the first section, **Basic Information**. 

|**Field**|**Value**|
|---|---|
|Name|pack-tutorial-profile|
|Version|`1.0.0`|
|Description|Cluster profile as part of the pack tutorial.|
|Type|Full|
|Tags|`spectro-cloud-education, app:hello-universe, terraform_managed:true`|

Click on the **Next** button at the bottom to move on to the next section. 
<br />

### Cloud Type
In the **Cloud Type** section, choose AWS as the infrastructure provider for this tutorial. If you want to choose any other cloud service provider, the core infrastructure layers options, as outlined in the **Profile Layers** section below, will differ from this tutorial. 

Again, click on the **Next** button at the bottom to move on to the next section.  

<br />

### Profile Layers
In the **Profile Layers** section, add the following core infrastructure layers if you have chosen the AWS cloud service provider. To deploy your resource to Azure or Google Cloud, use the core infrastructure layers outlined in the **Cloud Service Provider Configurations** section [here](https://github.com/spectrocloud/tutorials/tree/main/terraform/pack-tf/README.md).

|**Pack Type**|**Registry**|**Pack Name**|**Pack Version**| 
|---|---|---|---|
|OS|Public Repo|Ubuntu|`LTS__20.4.x`|
|Kubernetes|Public Repo|Kubernetes|`1.24.x`|
|Network|Public Repo|Calico|`3.25.x`|
|Storage|Public Repo|Amazon EBS CSI|`1.16.x`|

Click on the **Next layer** button at the bottom after adding each layer. After adding the **Storage** layer, click on the **Confirm** button to finish adding the core infrastructure layers. Palette will show the newly created infrastructure profile as a layered diagram. You can click on any layer icons to make further edits or change the version if desired. 

Once you confirm the core infrastructure layers, click the **Add New Pack** button at the top to add the following two add-on layers. The Spectro Proxy pack mentioned below will enable a reverse proxy to connect to the cluster's API. Refer to the [Spectro Proxy](https://docs.spectrocloud.com/integrations/frp/) for more details. The **Hello Universe** pack mentioned below is the custom add-on pack you defined and pushed to the **private-pack-registry** earlier in this tutorial. 

|**Pack Type**|**Registry**|**Pack Name**|**Pack Version**| 
|---|---|---|---|
|Authentication | Public Repo| Spectro Proxy | `1.3.x`|
|App Services | private-pack-registry | Hello Universe | `1.0.x` |

Click on the **Confirm & Create** button at the bottom after adding each add-on layer. 

Palette will show the newly created full cluster profile as long as there are no errors or compatibility issues between the individual layers. Verify the layers you've added. Click on the **Next** button at the bottom to move on to the last section.    


<br />

![Visual of the Profile Layers success.](/tutorials/create-pack/registries-and-packs_create-pack_profile-layer.png)

<br /> <br />


### Review
Lastly, review and click on the **Finish Configuration** button to finish creating the cluster profile. 

<br /> <br />

## Create a Cluster
While in the **Profile** section in the Palette's left **Main Menu**,  click on the newly created cluster profile to view the details. Palette will display the constituting layers and allow you to edit any of them. 

After reviewing the cluster profile layers, click on the **Deploy** button on the top right to deploy a *new* cluster. The cluster deployment wizard will present you with the following sections. 
<br />

### Basic Information
Use the following values in the first section, **Basic Information**. 

|**Field**|**Value**|
|---|---|
|Cluster name| pack-tutorial-cluster |
|Description| Cluster as part of the pack tutorial.|
|Tags|`spectro-cloud-education, app:hello-universe, terraform_managed:true`|
|Cloud Account|spectro-cloud|

Note that the AWS cloud account name in this tutorial example is **spectro-cloud**. However, you must choose the cloud account name configured in your Palette's project settings. 

Click on the **Next** button at the bottom to move on to the next section.    

<br /> 

### Parameters
The **Parameters** section allows you to change the profile configurations. For example, clicking on the **Hello Universe 1.0.x** layer will allow you to configure the `registry`, `repository`, and `tag` parameters defined in the **values.yaml** file. 
<br />

![Visual of the Cluster layers.](/tutorials/create-pack/registries-and-packs_create-pack_cluster-layers.png)

<br /> <br />

Keep all the parameter values as default and click on the **Next** button at the bottom to move on to the next section.    

<br />

### Cluster config
In the **Cluster config** section, ensure the **Static Placement** field is unchecked. If checked, the **Static Placement** will deploy the cluster in an existing VPC, and you will need the [Amazon Resource Names](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference-arns.html) (ARNs) for the existing subnets, roles, and other resources. But, for this tutorial, choose the dynamic placement where Palette will create a new VPC and all other resources needed for the cluster. 

For the **Region** field, select the region of your choice. The tutorial example will deploy the cluster in the  **us-east-2** region. For the **SSH Key Pair Name** field, choose the SSH key pair name from the selected region. You must have an SSH key created already in the AWS region where you will deploy the cluster.

Click on the **Next** button at the bottom to move on to the next section.    

<br />

### Nodes config
In the **Nodes config** section, provide the details for the master and the worker pools. For learning purposes, you can use the following minimal configuration:

|**Field** | **Value for the master-pool**| **Value for the worker-pool**|
|---| --- | ---|
|Node pool name| master-pool | worker-pool |
|Number of nodes in the pool| `1` | `1` |
|Allow worker capability| Checked | Not applicable |
|Enable Autoscaler | Not applicable | No |
|Rolling update |  Not applicable | Expand First. <br /> Launch a new node first, then shut down the old one. |

Keep the **Cloud Configuration** the same for the master and worker pools.

|**Field** | **Value**|
|---| --- | ---|
|Instance Type | General purpose `m4.xlarge` <br />A minimum allocation of four CPU cores are required for the master node. |
|Availability zones | Choose any *one* availability zone.<br /> This tutorial example will deploy to the `us-east-2a` availability zone. | 
|Disk size | 60 GiB | 

Click on the **Next** button at the bottom to move on to the next section.    
<br /> 

### Settings 
The section presents the options for OS patching, scheduled scans, scheduled backups, and defining the cluster role binding. 
Use the default values in the **Settings** section, and click on the **Validate** button at the bottom to move on to the last section.      

<br /> 

### Review
Review all configurations in this section. It will display the cluster name, tags, cloud account name, node pools, layers, and an estimated hourly cost. If everything looks good, click on the **Finish Configuration** button to finish deploying the cluster. It will start deploying the cluster and may take up to *15-20 minutes* to finish. 

While the deployment is in progress, Palette will display the cluster status as **Provisioning**. Please wait for the cluster deployment to finish, and while it's in progress, explore the multiple tabs in the cluster's details page, such as **Overview**, **Workloads**, and **Events**. 

<br /> 

</Tabs.TabPane>

<Tabs.TabPane tab="Terraform Code" key="terraform_code">

The [Spectro Cloud Terraform provider](https://registry.terraform.io/providers/spectrocloud/spectrocloud/latest/docs) allows the creation and management of Palette resources using Infrastructure as Code (IaC), which has several advantages, such as automating infrastructure, facilitating collaboration, documenting infrastructure, and keeping all infrastructure in a single source of truth.

## Starter Code
Navigate back to the tutorials container bash session. In the tutorials container, you will find the starter Terraform files. If you have closed the terminal session, you can reopen another bash session in the tutorials container using the following command. 
<br />

```bash
docker exec -it tutorialContainer bash
```

Change to the **terraform/pack-tf** directory containing the Terraform code for this tutorial. 
<br />

```bash
cd terraform/pack-tf
```

## Set up the Spectro Cloud API key

To get started with the Terraform code, you need a Spectro Cloud API key to authenticate and interact with Palette API endpoint. To add a new API key, log in to Palette, click on the user **User Menu** in the top-right corner, and select **My API Keys**, as shown in the visual below. 

<br /> <br />

![Visual of generating an API key in Palette.](/tutorials/create-pack/registries-and-packs_create-pack_generate-api-key.png )

<br />

Here are the steps to add and export an API key:

1. Fill in the required fields, such as the API key name and expiration date, and confirm to add the key. 

2. Copy the key value to your clipboard, and switch back to the tutorials container environment. 

3. Export the API key as an environment variable in the tutorials container bash session so the Terraform code can authenticate with Palette API.
  <br />

  ```bash
  export SPECTROCLOUD_APIKEY=<Your-Spectro-Cloud-API-key>
  ```
<br />

## Review Terraform Files
Ensure that you have the following files in the current working directory.
<br />

```bash
.
├── profile.tf		# Resource
├── cluster.tf		# Resource
├── data.tf			  # Spectro Cloud data resources
├── inputs.tf		  # Input varibales
├── outputs.tf		# Output variables
└── provider.tf		# Spectro Cloud Terraform provider 
```

Note that the Terraform code will deploy the resources to **AWS**. We recommend that you explore all Terraform files. Here is a high-level overview of each file:

-  **profile.tf** - has the configuration for `spectrocloud_cluster_profile` resource. Review the core infrastructure layers that comprise the `spectrocloud_cluster_profile` resource. 


-  **cluster.tf** - has the configuration for `spectrocloud_cluster_aws` resource. The cluster resource depends upon the `spectrocloud_cluster_profile` resource. 


- **data.tf** - contains the configuration for the resources to retrieve data from Palette dynamically. For deploying the `spectrocloud_cluster_profile` resource, here are the pack details for each infrastructure layer. 

  |**Pack Type**|**Registry**|**Pack Name**|**Tag**| **Version** |
  |---|---|---|---|
  |OS|Public Repo|`ubuntu-aws`|`LTS__20.4.x`| `20.04`|
  |Kubernetes|Public Repo|`kubernetes`|`1.24.x`| `1.24.10` |
  |Network|Public Repo|`cni-calico`|`3.25.x`|`3.25.0`|
  |Storage|Public Repo|`csi-aws-ebs`|`1.16.x`|`1.16.0`|

  Be aware that the Terraform code, when executed, will deploy the resources to the AWS cloud service provider. To deploy your resource to Azure or Google Cloud, use the specific layer details outlined in the **Cloud Service Provider Configurations** section [here](https://github.com/spectrocloud/tutorials/tree/main/terraform/pack-tf/README.md). 



- **inputs.tf** - contains all the Terraform variables and the default values used in the tutorial. Before executing the terraform commands, verify and update the default value for all variables. In particular,  update the value for the `cluster_cloud_account_aws_name`, `ssh_key_name`, and `private_pack_registry` variables. You will find the `# ToDo` tags against the fields you want to update. Leave the remaining fields as default, assuming you will continue deploying to the AWS cloud. 


- **outputs.tf** - contains the output variables to expose information.


- **provider.tf** - contains the provider configuration and version.

<br /> 

## Deploy Terraform
After updating the **inputs.tf** file, and carefully reviewing the other files, initialize the Terraform provider:
<br />

```bash
terraform init
```

The `init` command above will download plugins and providers from the **provider.tf** file. Next, preview the resources Terraform will create. 
<br />

```bash
terraform plan
```

The output displays the resources Terraform will create in an actual implementation. 
<br />

```bash
# Output condensed for readability
Plan: 2 to add, 0 to change, 0 to destroy.
```

Lastly, finish creating all resources using the following command. 
<br />

```bash
terraform apply -auto-approve
```

It will take up to 20 minutes to provision a cluster. After successful provisioning the cluster, you will the following success message. 
<br />

```bash coloredLines=2-2|#49be25
# Output condensed for readability
Apply complete! Resources: 2 added, 0 changed, 0 destroyed.
```

You can observe the cluster deployment progress in Palette by navigating back to Palette.

<br /> 


## Check the In-Progress Deployment
Log back into the [Palette](https://console.spectrocloud.com/), and navigate to the **Profile** section in the left **Main Menu**. If the Terraform deployment is successful, you will see the newly created cluster profile, as shown in the visual below. 

<br />

![Visual of the successful Profile in Palette.](/tutorials/create-pack/registries-and-packs_create-pack_verify-profile.png)

<br /> <br />

</Tabs.TabPane>

</Tabs>

<br /> <br />

# Validate
In Palette, navigate to the left **Main Menu** and select **Clusters**. Next, select your cluster to access its details page that contains the deployment status. After Palette finishes provisioning the cluster, the status will turn to **Running** and **Healthy**.  

<br /> 

![Visual of the cluster health.](/tutorials/create-pack/registries-and-packs_create-pack_cluster-health.png)

<br /> <br />

Once the cluster status is **Running** and **Healthy**, you can access the application from the exposed service URL with the port number displayed. For the Hello Universe application, port 8080 is exposed. Click on the URL to access the application.
<br />

<WarningBox>
It takes between one to three minutes for DNS to properly resolve the public load balancer URL. Therefore, we recommend waiting a few moments before clicking on the service URL to prevent the browser from caching an unresolved DNS request.
</WarningBox>

<br />

![Visual of the successful accessing the application using the load balancer URL.](/tutorials/create-pack/registries-and-packs_create-pack_success.png)

<br /> <br />

You can also look at real-time metrics, such as CPU and memory consumption, in the cluster's **Overview** tab in Palette. 

<br />

![Visual of the cluster metrics.](/tutorials/create-pack/registries-and-packs_create-pack_cluster-metrics.png)

<br /> <br />

Using your custom pack in the cluster, you have successfully deployed the Hello Universe application to the cluster. 

<br />

# Cleanup
Delete the cluster, cluster profile, and registry server, and remove the registry service configuration from Palette's settings. 

##  Delete the Cluster and Cluster Profile using Terraform
If you've used Terraform to deploy the cluster, switch back to the tutorials container, and issue the following command from within the **terraform/pack-tf** directory:
<br />

```bash
terraform destroy -auto-approve
```

Wait for the resources to clean up. Deleting the Terraform resources may take up to 10 minutes. 
<br />

```bash coloredLines=2-2|#49be25
# Output condensed for readability
Destroy complete! Resources: 2 destroyed.
```
<br />

##  Delete the Cluster and Cluster Profile using Palette
Navigate to the **Cluster** section in Palette's left **Main Menu**, and view the details page of the **pack-tutorial-cluster**. To delete the cluster, click on the **Settings** on the top right to expand the **drop-down Menu**, and click on the **Delete Cluster** option. Palette will prompt you to enter the cluster name to confirm the delete action. Type the cluster name to proceed with the delete step. 

<br />

![Visual of deleting the cluster in Palette.](/tutorials/create-pack/registries-and-packs_create-pack_delete-cluster.png)

<br /> <br />

The cluster status will turn to **Deleting**, and will take up to 10 minutes to finish deleting the cluster.
<br />

<InfoBox>
If a cluster remains in the delete phase for over 15 minutes, it becomes eligible for Force Delete. To trigger a force delete, navigate to the respective cluster's details page and click on Settings. Click on the Force Delete Cluster to delete the cluster. Palette will automatically remove clusters stuck in the cluster deletion phase for over 24 hours.
</InfoBox>
<br />

After deleting the cluster, delete the cluster profile by navigating to the **Profile** section and choosing the **Delete** option within the **three-dot Menu** against the cluster profile name.

<br />

![Visual of deleting the profile in Palette.](/tutorials/create-pack/registries-and-packs_create-pack_delete-profile.png)

<br /> <br />

Wait for the resources to clean up and ensure the successful resource deletion in Palette. 

##  Delete the Registry Server
After deleting the cluster and the cluster profile, stop the registry server by closing the tutorials container bash session serving the Ngrok reverse proxy server. At this point, you can delete all bash sessions into the tutorials container. To remove the container and the image from the local machine, issue the following commands:
<br />

```bash
docker container rm --force tutorialContainer
docker image rm --force ghcr.io/spectrocloud/tutorials:1.0.3
```

Lastly, delete the registry service configuration from the Palette by navigating to **Admin Settings** > **Registries** > **Pack Registries** as a Tenant admin.

<br /> 


# Wrap-Up

In this tutorial, you learned how to create a custom pack using manifest files. You packaged up an application in a custom pack that you pushed to a private registry server that you later added to Palette.

Next, you created a cluster profile that included all the core infrastructure layers, such as the OS, Kubernetes distribution, and more. You also added your custom pack to the cluster profile so your application could be deployed to a Kubernetes cluster. 

Packs are the building blocks of cluster profiles. It's what allows you to customize all your Kubernetes clusters. Palette allows you to use different packs to create multiple cluster profiles, each for specific purposes. As a result, you can ensure all Kubernetes deployments contain all the required dependencies and applications without developing complicated deployment scripts. All you need to do is maintain the cluster profiles.  

To learn more about packs in Palette, we encourage you to check out the reference resources below.


- [Custom OS Pack](/registries-and-packs/add-custom-packs#addinganospack)

- [Add-on Packs](/registries-and-packs/adding-add-on-packs)

- [Pack constraints](/registries-and-packs/pack-constraints)

<br /> <br />


