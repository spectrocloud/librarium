---
title: "Build Edge Artifacts"
metaTitle: "Build Edge Artifacts"
metaDescription: "Learn how to build your installer and provider images using CanvOS GitHub repository."
icon: ""
hideToC: false
fullWidth: false
hideToCSidebar: false
hiddenFromNav: false
---

import Tabs from 'shared/components/ui/Tabs';
import WarningBox from 'shared/components/WarningBox';
import InfoBox from 'shared/components/InfoBox';
import PointsOfInterest from "shared/components/common/PointOfInterest";

# Overview
	
Palette's Edge native solution requires Edge hosts to be ready with the Palette Edge host agent, an operating system, and metadata installed. You can install these essential components using Edge Installer ISO image in the Edge hosts. 


In addition, suppose you want to use a Linux distribution of your choice for the cluster. In that case, you will need a provider image to install immutable Linux distribution compatible with a specific Kubernetes version at runtime, i.e., during the cluster deployment. Palette offers Bring Your Own Operating System (BYOOS) feature to support this use case. 


In this guide, you will use Spectro Cloud's utility, CanvOS, to create the following Edge artifacts, which you can then use to prepare an Edge host and deploy a lightweight Kubernetes cluster.
<br />

* **Edge Installer ISO image** - This ISO image includes the Edge Installer, which installs the Palette Edge host agent, operating system, and metadata in the Edge hosts. 


* **Provider OS images** - These are [Kairos](https://kairos.io/)-based provider images for each supported OS and Kubernetes version combination. You can use one of these images using the BYOOS feature. These images can install OS, Kubernetes distribution, and other software dependencies during the cluster deployment. The Edge Installer, which should already be present on the host device, downloads these container images on the host device at runtime. 

  This exmaple will build two Ubuntu images - one compatible with lightweight Kubernetes (K3s) v1.24.6 and another with K3s v1.25.2.




# Prerequisites
To complete this guide, you will need the following items:
<br/>

* A physical or virtual Linux machine with **AMD64** (also known as **x86_64**) processor architecture. You can issue the following command in the terminal to check your processor architecture. 
  <br/>

  ```bash
  uname -m
  ```

* Minimum hardware configuration:
  - 4 CPU
  - 8 GB memory
  - 50 GB storage
 

* [Git](https://cli.github.com/manual/installation) version 2.30.x or later. You can check your git version using `git --version` command.


* [Docker Engine](https://docs.docker.com/engine/install/) version 20.10.x or later. Using the ' docker version ' command, you can check the Docker Engine version. Ensure you can create [privileged containers](https://docs.docker.com/engine/reference/commandline/run/#privileged) on your machine.


* A [Spectro Cloud](https://console.spectrocloud.com) account. If you have not signed up, you can sign up for a [free trial](https://www.spectrocloud.com/free-tier/).


* Tenant admin access to Palette to generate a new registration token for Edge hosts.


# Build Edge Artifacts


1. Check out the [CanvOS](https://github.com/spectrocloud/CanvOS.git) GitHub repository containing the starter code. 
  <br />

  ```bash
  git clone https://github.com/spectrocloud/CanvOS.git
  ```
  Change to the **CanvOS/** directory. 
  <br />

  ```bash
  cd CanvOS
  ```

  The files relevant for the current guide are present in the **v3.3.3** tag. Checkout the desired tag.
  <br />

  ```shell
  git checkout v3.3.3
  ```

  Here are the relevant files. 
  <br />

  ```bash
  .
  ├── .arg          # Defines mutiple variables
  ├── Dockerfile    # Bakes the arguments to use in the image
  ├── Earthfile     # Series of commands for creating target images
  ├── earthly.sh    # Script to invoke the Earthfile, and generate target images
  └── user-data.template  # A sample user-data file
  ```
  <br />


2. This step is optional. In this step, you can define a custom image tag for provider OS images and several other arguments, such as the image registry, image repository, OS distribution, Kubernetes distribution, and ISO file name, as outlined in this [Readme](https://github.com/spectrocloud/CanvOS/blob/main/README.md). You can use the default values for all these arguments, and skip to the next step if you do not want to customize them.

  For instance, if you want to change the image tag, edit the value for the `CUSTOM_TAG` variable. Ensure that it is of lowercase alphanumeric characters. Palette Edge host agent will use this variable as a tag suffix in the provider images. The current example uses  `demo` as a tag suffix.
  <br />

  ```bash
  CUSTOM_TAG=demo
  ```
  If you use the default value for all arguments, the provider image name will be similar to `ttl.sh/ubuntu:k3s-1.25.2-v3.4.1-demo`.
  <br />


3. In this step, you will create an auto-registration token in Palette to allow Edge hosts to register themselves with Palette automatically. Palette 3.4 onwards, a registration token created by the Tenant admin, is now *required* for pairing an Edge host with Palette. Palette offers three registration methods: auto, manual, and QR code. This guide uses the auto-registration method. For more details, refer to the [Register Edge Host](https://docs.spectrocloud.com/clusters/edge/site-deployment/site-installation/edge-host-registration) documentation.

  Log in to [Palette](https://console.spectrocloud.com), switch to the tenant admin view, and navigate to **Tenant Settings** > **Registration Tokens**. Click on **Add New Registration Token** and enter the following values to create a new token.

  |**Field**|**Value**|
  |----|----|
  | Registration Token Name | DemoToken |
  | Description | Token for Build Edge Native Artifacts how-to/tutorial |
  | Default Project | Default |
  | Expiration Date | 7 days |

  Click on **Confirm** button at the bottom to finish generating a token. 
  <br />

  ![Screenshot of a registration token in Palette](/tutorials/palette-canvos/clusters_edge_palette-canvos_registration-token.png)

  <br />

  Copy the newly created token to a clipboard or notepad file to use later in this guide. 
  <br />


4. The next step is to create a **user-data** file that embeds the Edge host's login credentials and auto-registration token in the Edge Installer ISO image. If you want further customization, refer to the [Edge Configuration Stages](https://docs.spectrocloud.com/clusters/edge/edge-configuration/cloud-init#edgeconfigurationstages) and [User Data Parameters](https://docs-latest.spectrocloud.com/clusters/edge/edge-configuration/installer-reference) documents outlining different other stages and possible parameters, respectively. 

  To create a minimalistic **user-data** file for the current example, copy and issue the command below. Before you issue this command, ensure to edit the `edgeHostToken` parameter value with the registration token you created in the last step. Also, you can click on the *Points of Interest* numbers below to learn more about main attributes relevant for this example. 
  <br />

  <PointsOfInterest
    points={[
      {
        x: 370,
        y: 185,
        label: 1,
        description: "Stores the registration token and lets the agent use the auto-registration functionality and authenticate with the provided token.",
        tooltipPlacement: "rightTop",
      },
      {
        x: 190,
        y: 262,
        label: 2,
        description: "Instructs the installer to turn the host machine off once the installation is complete.",
      },
      {
        x: 190,
        y: 340,
        label: 3,
        description: "Sets the login credentials for Edge hosts. The login credentials will allow you to SSH log into the edge host for debugging purposes.",
        tooltipPlacement: "rightTop",
      },
    ]}
  >

  ```shell
  cat <<'EOF' > user-data
  #cloud-config
  stylus:
    site:
      edgeHostToken: aUAxxxxxxxxx0ChYCrO
  install:
    poweroff: true
  users:
    - name: kairos
      passwd: kairos
  EOF
  ```

  </PointsOfInterest>
  <br />


5. Issue the following command to build the Edge artifacts. 
  <br />

  ```shell
  ./earthly.sh +build-all-images --PE_VERSION=$(git describe --abbrev=0 --tags)
  ```

  ```bash coloredLines=2-2|#006622
  # Output condensed for readability
  ===================== Earthly Build SUCCESS ===================== 
  Share your logs with an Earthly account (experimental)! Register for one at https://ci.earthly.dev.
  ```
  This command will take up to 15-20 minutes to finish.
  <br />

# Validate
1. List the edge installer ISO image and checksum by issuing the following command from the **CanvOS/** directory.
<br />

  ```shell
  ls build/
  ```

  ```shell coloredLines=2-3|#666666
  # Output
  palette-edge-installer.iso      
  palette-edge-installer.iso.sha256
  ```
  <br />

2. List the Docker images to show two provider OS images, one compatible with lightweight Kubernetes (K3s) v1.24.6 and another with K3s v1.25.2.
<br />

  ```shell
  docker images
  ```

  ```bash coloredLines=3-4|#666666
  # Output
  REPOSITORY        TAG                       IMAGE ID        CREATED         SIZE
  ttl.sh/ubuntu     k3s-1.25.2-v3.3.3-demo    b3c4956ccc0a    6 minutes ago   2.49GB
  ttl.sh/ubuntu     k3s-1.24.6-v3.3.3-demo    fe1486da25df    6 minutes ago   2.49GB
  earthly/earthly   v0.7.4                    d771cc8edc38     2 weeks ago    333MB
  ```
  <br />

After building the Edge artifacts, you can move on to the [Deploy Edge Native Cluster](/clusters/edge/deploy-cluster) tutorial to learn how to prepare Edge hosts using these artifacts and deploy a lightweight Kubernetes cluster.