---
title: "Build Edge Artifacts"
metaTitle: "Build Edge Artifacts"
metaDescription: "Learn how to build your installer and provider images using CanvOS GitHub repository."
icon: ""
hideToC: false
fullWidth: false
hideToCSidebar: false
hiddenFromNav: false
---

import Tabs from 'shared/components/ui/Tabs';
import WarningBox from 'shared/components/WarningBox';
import InfoBox from 'shared/components/InfoBox';
import PointsOfInterest from "shared/components/common/PointOfInterest";

# Overview
Palette's Edge solution requires Edge hosts to be ready with the required tools and configurations before deploying a host cluster. An Edge host requires the following artifacts for a successful deployment:
<br />

* **Edge Installer ISO image** - This bootable ISO image helps install the necessary tools and configurations on a bare host machine. During installation, the host machine will boot from the Edge Installer ISO, partition the disk, copy the image to the disk, install the software (Palette Edge host agent and metadata), and perform several configuration steps. These configuration steps include registering the host with Palette, setting user privileges, and configuring network or security settings. 
<br />

* **Provider OS image** - This is a [Kairos](https://kairos.io/)-based image. This image helps install an immutable Operating System (OS) and software dependencies compatible with a specific Kubernetes version at runtime, i.e., during the cluster deployment.  


In this guide, you will use Spectro Cloud's utility, CanvOS, to create an Edge Installer ISO image and two provider OS images - one compatible with lightweight Kubernetes (K3s) v1.24.6 and another compatible with K3s v1.25.2.


This guide presents two workflows - Basic and Advanced. You can follow either of the workflows below. Use Basic for a quick start to get all the required artifacts for preparing an Edge host. Use the Advanced section for detailed instructions and to learn about customization options you can apply to this workflow. 
<br /> <br />

<Tabs>

<Tabs.TabPane tab="Basic" key="basic_create_artifacts">


# Prerequisites
To complete this guide, you will need the following items:
<br/>

* A physical or virtual Linux machine with **AMD64** (also known as **x86_64**) processor architecture. You can issue the following command in the terminal to check your processor architecture. 
  <br/>

  ```bash
  uname -m
  ```

* Minimum hardware configuration:
  - 4 CPU
  - 8 GB memory
  - 50 GB storage
 

* [Git](https://cli.github.com/manual/installation) version 2.30.x or later. You can check your git version using `git --version` command.


* [Docker Engine](https://docs.docker.com/engine/install/) version 20.10.x or later. Using the ' docker version ' command, you can check the Docker Engine version. Ensure you can create [privileged containers](https://docs.docker.com/engine/reference/commandline/run/#privileged) on your machine.


* A [Spectro Cloud](https://console.spectrocloud.com) account. If you have not signed up, you can sign up for a [free trial](https://www.spectrocloud.com/free-tier/).


* Palette registration token for Edge hosts. You will need tenant admin access to Palette to generate a new registration token. For detailed instructions, refer to the [Create Registration Token](/clusters/edge/site-deployment/site-installation/create-registration-token) guide.
<br />

  <InfoBox>

  A registration token is required for pairing an Edge host with Palette. Palette offers three registration methods: auto, manual, and QR code. This guide uses the auto-registration method. For more details, refer to the [Register Edge Host](https://docs.spectrocloud.com/clusters/edge/site-deployment/site-installation/edge-host-registration) documentation.

  </InfoBox>
  <br />
 

# Build Edge Artifacts
Here are the instructions for a quick start to create all the required artifacts. 
<br />

<WarningBox>

You must have a tenant registration token before following the instructions below.

</WarningBox>
<br />

1. Check out the [CanvOS](https://github.com/spectrocloud/CanvOS.git) GitHub repository containing the starter code. 
  <br />

  ```bash
  git clone https://github.com/spectrocloud/CanvOS.git
  ```


2. Change to the **CanvOS/** directory. 
  <br />

  ```bash
  cd CanvOS
  ```


3. The files relevant to the current guide are in the **v3.3.3** tag. Check out the desired tag. You can check out a more recent and stable version if available. 
  <br />

  ```shell
  git checkout v3.3.3
  ```


4. Review the relevant files. 
  <br />

  ```bash
  .
  ├── .arg          # Defines mutiple variables
  ├── Dockerfile    # Bakes the arguments to use in the image
  ├── Earthfile     # Series of commands for creating target images
  ├── earthly.sh    # Script to invoke the Earthfile, and generate target images
  └── user-data.template  # A sample user-data file
  ```
  <br />


5. Define a custom image tag for provider OS images. To change the image tag, edit the value for the `CUSTOM_TAG` variable in the **.arg** file. Ensure that it is of lowercase alphanumeric characters. 
  <br />

  ```bash
  CUSTOM_TAG=palette-learn
  ```
  <br />
 
  <InfoBox>

  Before you move on to creating a user data file, you must have a Palette registration token with you. If you still need to create it, check the prerequisites section, and refer to the [Create Registration Token](/clusters/edge/site-deployment/site-installation/create-registration-token) guide. 

  </InfoBox>
  <br />


6. Create a **user-data** file that embeds the Edge host's login credentials and registration token in the Edge Installer ISO image. Issue the command below to save your registration token in a local variable. 
<br />

  ```bash
  token="your_token_here"
  ```
  <br />
  
7. Next, copy and issue the command below to create the **user-data** file. Also, you can click on the *Points of Interest* numbers below to learn more about the main attributes relevant to this example. 
  <br />

  <PointsOfInterest
    points={[
      {
        x: 260,
        y: 187,
        label: 1,
        description: "Stores the registration token and lets the agent use the auto-registration functionality and authenticate with the provided token.",
        tooltipPlacement: "rightTop",
      },
      {
        x: 190,
        y: 262,
        label: 2,
        description: "Instructs the installer to turn the host machine off once the installation is complete.",
      },
      {
        x: 190,
        y: 340,
        label: 3,
        description: "Sets the login credentials for Edge hosts. The login credentials will allow you to SSH log into the edge host for debugging purposes.",
        tooltipPlacement: "rightTop",
      },
    ]}
  >

  ```shell
  cat << EOF > user-data
  #cloud-config
  stylus:
    site:
      edgeHostToken: $token
  install:
    poweroff: true
  users:
    - name: kairos
      passwd: kairos
  EOF
  ```

  </PointsOfInterest>
  <br />


7. Issue the following command to execute the **earthly.sh** file to build the Edge artifacts. The `--PE_VERSION` option in the command below signifies the Palette Edge version to use. The current example uses the **v3.3.3** git tag.
  <br />

  ```shell
  ./earthly.sh +build-all-images --PE_VERSION=$(git describe --abbrev=0 --tags)
  ```

  ```bash coloredLines=2-2
  # Output condensed for readability
  ===================== Earthly Build SUCCESS ===================== 
  Share your logs with an Earthly account (experimental)! Register for one at https://ci.earthly.dev.
  ```
  This command may take up to 15-20 minutes to finish depending on the resources of the host machine.
  <br />


8. To use the provider OS images in your cluster profile, push them to the image registry mentioned in the **.arg** file. The current example and default behavior uses the [ttl.sh](https://ttl.sh/) image registry. This image registry is free to use and does not require a sign-up. Images pushed to *ttl.sh* are ephemeral and will expire after the 24 hrs time limit.  Use the following commands to push the provider OS image to the *ttl.sh* image registry.  
  <br />

  ```bash
  docker push ttl.sh/ubuntu:k3s-1.25.2-v3.3.3-palette-learn
  docker push ttl.sh/ubuntu:k3s-1.24.6-v3.3.3-palette-learn
  ```
  <br />

  <WarningBox>

  As a reminder, [ttl.sh](https://ttl.sh/) is a short-lived image registry. If you do not use these provider OS images in your cluster profile within 24 hours of pushing to *ttl.sh*, they will expire and must be re-pushed. Refer to the Advanced workflow in the current guide to learn how to use another registry, such as Docker Hub, and tag the docker images accordingly.

  </WarningBox>
  <br />


# Validate
1. List the edge installer ISO image and checksum by issuing the following command from the **CanvOS/** directory.
<br />

  ```shell
  ls build/
  ```

  ```shell
  # Output
  palette-edge-installer.iso      
  palette-edge-installer.iso.sha256
  ```
  <br />

2. List the Docker images to show two provider OS images - one compatible with K3s v1.24.6 and another with K3s v1.25.2.
<br />

  ```shell
  docker images
  ```

  ```bash coloredLines=3-4
  # Output
  REPOSITORY        TAG                                IMAGE ID       CREATED         SIZE
  ttl.sh/ubuntu     k3s-1.25.2-v3.3.3-palette-learn    b3c4956ccc0a   6 minutes ago   2.49GB
  ttl.sh/ubuntu     k3s-1.24.6-v3.3.3-palette-learn    fe1486da25df   6 minutes ago   2.49GB
  earthly/earthly   v0.7.4                             d771cc8edc38   2 weeks ago     333MB
  ```


</Tabs.TabPane>

<Tabs.TabPane tab="Advanced" key="advanced_create_artifacts">


# Prerequisites
To complete this guide, you will need the following items:
<br/>

* A physical or virtual Linux machine with **AMD64** (also known as **x86_64**) processor architecture. You can issue the following command in the terminal to check your processor architecture. 
  <br/>

  ```bash
  uname -m
  ```

* Minimum hardware configuration:
  - 4 CPU
  - 8 GB memory
  - 50 GB storage
 

* [Git](https://cli.github.com/manual/installation) version 2.30.x or later. You can check your git version using `git --version` command.


* [Docker Engine](https://docs.docker.com/engine/install/) version 20.10.x or later. Using the ' docker version ' command, you can check the Docker Engine version. Ensure you can create [privileged containers](https://docs.docker.com/engine/reference/commandline/run/#privileged) on your machine.


* A [Spectro Cloud](https://console.spectrocloud.com) account. If you have not signed up, you can sign up for a [free trial](https://www.spectrocloud.com/free-tier/).


* Palette registration token for Edge hosts. You will need tenant admin access to Palette to generate a new registration token. For detailed instructions, refer to the [Create Registration Token](/clusters/edge/site-deployment/site-installation/create-registration-token) guide.
<br />

  <InfoBox>

  A registration token is required for pairing an Edge host with Palette. Palette offers three registration methods: auto, manual, and QR code. This guide uses the auto-registration method. For more details, refer to the [Register Edge Host](https://docs.spectrocloud.com/clusters/edge/site-deployment/site-installation/edge-host-registration) documentation.

  </InfoBox>
  <br />

* An account with [Docker Hub](https://hub.docker.com/) image registry. This prerequisite is needed if you follow the Advanced workflow below. If you do not have an account with Docker Hub already, refer to the [Create an account](https://docs.docker.com/docker-id/) page for signing-up instructions. 
<br />

  <InfoBox>

  This guide uses Docker Hub as an example. You can, however, use any other desired image registry to suit your requirements.

  </InfoBox>
  <br />

* A public repository named `opensuse-leap` in your image registry. Refer to the [Create a repository](https://docs.docker.com/docker-hub/repos/create/#create-a-repository) instructions for creating a Docker Hub repository and setting the repository's visibility to public. 

# Build Edge Artifacts
Here are the detailed instructions for creating customized artifacts.
<br />

<WarningBox>

You must have a tenant registration token, an image registry account, and an image repository ready before following the instructions below.

</WarningBox>
<br />

1. Check out the [CanvOS](https://github.com/spectrocloud/CanvOS.git) GitHub repository containing the starter code. 
  <br />

  ```bash
  git clone https://github.com/spectrocloud/CanvOS.git
  ```
  

2. Change to the **CanvOS/** directory. 
  <br />

  ```bash
  cd CanvOS
  ```


3. The files relevant to the current guide are in the **v3.3.3** tag. Check out the desired tag. You can check out a more recent and stable version if available.
  <br />

  ```shell
  git checkout v3.3.3
  ```


4. Review the relevant files.  
  <br />

  ```bash
  .
  ├── .arg          # Defines mutiple variables
  ├── Dockerfile    # Bakes the arguments to use in the image
  ├── Earthfile     # Series of commands for creating target images
  ├── earthly.sh    # Script to invoke the Earthfile, and generate target images
  └── user-data.template  # A sample user-data file
  ```
  <br />


5. Review the **.arg** file containing the customizable arguments, such as image tag, image registry, image repository, and OS distribution. The table below shows all arguments, their default, and possible values.

  |**Argument**|**Description**|**Default Value**| **Other Possible Values** |
  |---|---|---|---|
  |`CUSTOM_TAG`|Tag for provider image|demo|Lowercase alphanumeric string without spaces|
  |`IMAGE_REGISTRY`|Image registry name|ttl.sh|Your image registry hostname, without `http` or `https` <br /> Example: registry.hub.docker.com|
  |`OS_DISTRIBUTION`|OS Distribution |ubuntu | opensuse-leap|
  |`IMAGE_REPO`|Image repository name.<br /> It is the same as the OS distribution.|`$OS_DISTRIBUTION`|Your image repository name|
  |`OS_VERSION`|OS Version, only applies to Ubuntu |22| 20|
  |`K8S_DISTRIBUTION`|Kubernetes Distribution |k3s| rke2, kubeadm |
  |`ISO_NAME`|Name of the Installer ISO|palette-edge-installer|String without spaces|
<br />


6. Edit the **.arg** file to customize the image tag for provider OS images, image registry, image repository, and OS distribution. Open up the **.arg** file in an editor and update the following variables. 
  <br />

    - Update the value for the `CUSTOM_TAG` variable to string made up of lowercase alphanumeric characters. This example uses `palette-learn` value. 
    <br />

    ```bash
    CUSTOM_TAG=palette-learn
    ```

    - Update the value for the `IMAGE_REGISTRY` to point it to the Docker Hub host. If you are using any other image registry, the hostname must comply with standard DNS rules, but may not contain underscores.
    <br />

    ```bash
    IMAGE_REGISTRY=registry.hub.docker.com
    ```

    - Update the value for the `OS_DISTRIBUTION` to OpenSuse Leap. 
    <br />

    ```bash
    OS_DISTRIBUTION=opensuse-leap
    ``` 
    <br />

  Use default values for the remaining variables. Using the customized arguments, the final provider image name will be similar to `registry.hub.docker.com/opensuse-leap:k3s-1.25.2-v3.4.1-palette-learn`.
  <br />


7. Open up the Dockerfile in an editor, and modify the existing Dockerfile to suit your needs. For example, a sample Dockerfile to install [WireGuard](https://www.wireguard.com/install/) on the Edge host is available below. 
  <br />
  
  <InfoBox>

  Add your customizations below the line tagged with the `Add any other image customizations here` comment. Do not edit or add any lines before this tagged comment. 

  </InfoBox>
  <br />

  ```bash
  ARG BASE
  FROM $BASE
  
  ############# Add any other image customizations here ############
  # Install WireGuard and required dependencies
  RUN apt-get update && apt-get install -y wireguard

  # Install Netplan
  RUN apt-get -y install netplan.io
  ```
  
  You can install more tools and dependencies and configure the host as needed.
  <br />

  <InfoBox>

  Before you move on to creating a user data file, you must have a Palette registration token with you. If you still need to create it, check the prerequisites section, and refer to the [Create Registration Token](/clusters/edge/site-deployment/site-installation/create-registration-token) guide. 

  </InfoBox>
  <br />


8. Create a **user-data** file that embeds the Edge host's login credentials and registration token in the Edge Installer ISO image. Issue the command below to save your registration token in a local variable. 
<br />

  ```bash
  token="your_token_here"
  ```
  
  Copy and issue the command below to create the **user-data** file. Also, you can click on the *Points of Interest* numbers below to learn more about the main attributes relevant to this example. 
  <br />

  <PointsOfInterest
    points={[
      {
        x: 260,
        y: 187,
        label: 1,
        description: "Stores the registration token and lets the agent use the auto-registration functionality and authenticate with the provided token.",
        tooltipPlacement: "rightTop",
      },
      {
        x: 190,
        y: 262,
        label: 2,
        description: "Instructs the installer to turn the host machine off once the installation is complete.",
      },
      {
        x: 190,
        y: 340,
        label: 3,
        description: "Sets the login credentials for Edge hosts. The login credentials will allow you to SSH log into the edge host for debugging purposes.",
        tooltipPlacement: "rightTop",
      },
    ]}
  >

  ```shell
  cat << EOF > user-data
  #cloud-config
  stylus:
    site:
      edgeHostToken: $token
  install:
    poweroff: true
  users:
    - name: kairos
      passwd: kairos
  EOF
  ```

  </PointsOfInterest> 

  If you want further customization, refer to the [Edge Configuration Stages](https://docs.spectrocloud.com/clusters/edge/edge-configuration/cloud-init#edgeconfigurationstages) and [User Data Parameters](https://docs-latest.spectrocloud.com/clusters/edge/edge-configuration/installer-reference) documents outlining different other stages and possible parameters, respectively. 
  <br />


9. Issue the following command to execute the **earthly.sh** file to build the Edge artifacts. The `--PE_VERSION` option in the command below signifies the Palette Edge version to use. Spectro Cloud generates a git tag for each new Palette release. The current example uses the **v3.3.3** git tag.
  <br />

  ```shell
  ./earthly.sh +build-all-images --PE_VERSION=$(git describe --abbrev=0 --tags)
  ```

  ```bash coloredLines=2-2
  # Output condensed for readability
  ===================== Earthly Build SUCCESS ===================== 
  Share your logs with an Earthly account (experimental)! Register for one at https://ci.earthly.dev.
  ```
  This command will take up to 15-20 minutes to finish.
  <br />


10. To use the provider OS images in your cluster profile, push them to your image registry mentioned in the **.arg** file. In continuation to the current example, use the following commands to push the the provider OS image to the Docker Hub image registry.  
  <br />

  ```bash
  docker push registry.hub.docker.com/opensuse-leap:k3s-1.25.2-v3.4.1-palette-learn
  docker push registry.hub.docker.com/opensuse-leap:k3s-1.24.6-v3.4.1-palette-learn
  ```
  <br />


# Validate
1. List the edge installer ISO image and checksum by issuing the following command from the **CanvOS/** directory.
<br />

  ```shell
  ls build/
  ```

  ```shell
  # Output
  palette-edge-installer.iso      
  palette-edge-installer.iso.sha256
  ```
  <br />

2. List the Docker images to show two provider OS images - one compatible with K3s v1.24.6 and another with K3s v1.25.2.
<br />

  ```shell
  docker images
  ```

  ```bash coloredLines=3-4
  # Output
  REPOSITORY                                TAG                                IMAGE ID       CREATED        SIZE
  registry.hub.docker.com/opensuse-leap     k3s-1.25.2-v3.4.1-palette-learn    b3c4956ccc0a   6 minutes ago  2.49GB
  registry.hub.docker.com/opensuse-leap     k3s-1.24.6-v3.3.3-palette-learn    fe1486da25df   6 minutes ago  2.49GB
  earthly/earthly                           v0.7.4                             d771cc8edc38   2 weeks ago    333MB
  ```

</Tabs.TabPane>

</Tabs>