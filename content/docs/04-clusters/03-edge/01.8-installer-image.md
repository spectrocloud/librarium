---
title: "Create an Installer Image"
metaTitle: "Create an Edge Installer Image"
metaDescription: "Learn how to create an installer image for Edge devices."
hideToC: false
fullWidth: false
---

import Tabs from 'shared/components/ui/Tabs';
import WarningBox from 'shared/components/WarningBox';
import InfoBox from 'shared/components/InfoBox';
import PointsOfInterest from 'shared/components/common/PointOfInterest';


# Create an Install Image

Palette supports two installation methods for edge devices: bare metal or VMware. Choose the preferred installation method and follow the related instructions set to get started. 

<br />

<Tabs identifier="environment">

<Tabs.TabPane tab="Bare Metal" key="bare-metal">

## Bare Metal

For bare metal edge hosts, creating the Palette edge installer variant involves generating an optical installer image (ISO) which is derived by customizing the default Palette Edge Installer. Site-specific settings, such as the configuration file are included in this image. Customization is performed using the Palette Edge Installer container.


## Prerequisites

* [git](https://git-scm.com/downloads) 2.32.2+ or greater.


* [Docker](https://www.docker.com/products/docker-desktop/) or similar container build tool.


* A bootable device, such as a USB drive, or a PXE server.


## Create ISO Image


1. Download the following git [repository](https://github.com/spectrocloud/pxke-samples).

   ```
     git clone https://github.com/spectrocloud/pxke-samples
   ```

2. A file called **.installer.env.template** serves as a template for settings you can customize. Make a copy of this file to **.installer.env.**

   ```
     cp .installer.env.template .installer.env
   ```

3. Create a configuration file titled **user-data.yaml**, and add the configuration settings for the edge device. Review the **readme** file for a sample configuration.
You can find additional guidance in the [Register and Manage Edge Native Cluster](clusters/edge/native#setupdevice) guide.


4. Update contents of the file **.installer.env** to customize the following attributes:

    -  Name of the ISO image to be generated - (Optional - this defaults to pxe-installer if not specified)

        ```shell
        ISO_IMAGE="pxe-installer-custom"
        ```

    -  The version of the Palette Edge installer agent. Review the [list](/component#stylusedgeinstallerimageversion) of available Stylus versions.

        ```shell
        INSTALLER_VERSION="2.0.7"
        ```

    - Target Docker image for the installer to generate - (Optional)

        ```shell
        IMAGE_NAME="gcr.io/my-repo/palette-edge-installer"
        ```

    - Path to the configuration file that contains site settings.

        ```shell
        USER_DATA_FILE="user-data.yamlâ€
        ```


5. Build the custom ISO. The creation process will take a few minutes depending on your system capabilities.

  ```shell
  ./build-installer.sh
  ```

  Output: 
    ```text
    ./build-installer.sh
    + source .installer.env
    + ISO=p6os-custom
    + INSTALLER_VERSION=v2.0.0-alpha11
    + BASE_IMAGE=gcr.io/spectro-dev-public/stylus-installer:v2.0.0-alpha11
    + IMAGE_NAME=gcr.io/spectro-dev-public/stylus-custom
    + IMAGE=gcr.io/spectro-dev-public/stylus-custom:v2.0.0-alpha11
    + USER_DATA_FILE=user-data
    + BUILD_PLATFORM=linux/amd64
    + echo 'Building custom gcr.io/spectro-dev-public/stylus-custom:v2.0.0-alpha11 from gcr.io/spectro-dev-public/stylus-installer:v2.0.0-alpha11'
    Building custom gcr.io/spectro-dev-public/stylus-custom:v2.0.0-alpha11 from gcr.io/spectro-dev-public/stylus-installer:v2.0.0-alpha11
    + '[' -f user-data ']'
    + docker build --build-arg BASE_IMAGE=gcr.io/spectro-dev-public/stylus-installer:v2.0.0-alpha11 -t gcr.io/spectro-dev-public/stylus-custom:v2.0.0-alpha11 --platform linux/amd64 -f images/Dockerfile.installer ./
    [+] Building 7.9s (7/7) FINISHED
    => [internal] load build definition from Dockerfile.installer                                                                                                     0.0s
    ...
    ...
    INFO[2023-02-15T22:08:06Z] Creating squashfs...
    DEBU[2023-02-15T22:08:06Z] Running cmd: 'mksquashfs /tmp/elemental-iso972415663/rootfs /tmp/elemental-iso972415663/iso/rootfs.squashfs -b 1024k -comp xz -Xbcj x86'
    ISO image produced: 161394 sectors
    Written to medium : 161424 sectors at LBA 48
    Writing to '/cOS/p6os-custom.iso' completed successfully
    ```


6. Locate the ISO file in the root directory. Using a bootable USB drive, PXE server, or other means, mount the ISO to the primary drive of the bare metal appliance. The installer flashes to the edge host's hard disk, and the host will shut down. The bare metal edge host appliance is ready to be shipped to the edge location.


<InfoBox>

You can use several software tools to create a bootable USB drive, such as [balenaEtcher](https://www.balena.io/etcher). For a PXE server, there are open-source projects such as [Fog](https://fogproject.org/download) or [Windows Deployment Services](https://learn.microsoft.com/en-us/windows/deployment/wds-boot-support) for Windows.

</InfoBox>


To deploy the device and register it with Palette, refer to the [Register and Manage Edge Native Clusters](/clusters/edge/native) guide.


## Validation

You can validate that the ISO image is not corrupted by attempting to flash a bootable device. Most software that creates a bootable device will validate the ISO image before the flash process. 

</Tabs.TabPane>

<Tabs.TabPane tab="VMware" key="vmware">

## VMware

Create an Open Virtual Appliance (OVA) file from the base Palette Edge Installer ISO for VMware environments by injecting customized settings (user data) through a secondary drive. 

## Prerequisites

* mkisofs, or genisoimage, or similar ISO management software.


* cdrtools or [wodim](https://cygwin.com/packages/summary/wodim.html) for Windows


* Access to vSphere.

## Create OVA Image


1. Create a file called **user-data**. 

  ```shell
  touch user-data
  ```

2. Use the content from the template in the [Set up Device section](/clusters/edge/native#setupdevice) to add your site configuration. Make the necessary changes for your environment.


2. Create an empty **meta-data** file:

  ```
  touch meta-data
  ```

3. Create a cloud init ISO using the following command.

  MacOS/Linux:
  ```
  mkisofs -output ci.iso -volid cidata -joliet -rock user-data meta-data
  ```

  Windows:
  ```
  genisoimage -output ci.iso -volid cidata -joliet -rock user-data meta-data
  ```
This generates an ISO file called ci.iso in the current directory.


4. Upload the **ci.iso** file generated in the previous step to a datastore in vSphere using the vCenter console.


5. Log in to [Palette](https://console.spectrocloud.com).


6. Navigate to the left **Main Menu** and select **Clusters**. 


7. Click on the **Edge Hosts** tab. 


8. In the **Edge Hosts** tab, click **Download Palette Edge Installer**. This downloads the default Palette Edge Installer image (ISO).


9. Upload Palette Edge Installer ISO to a datastore in vSphere using the vCenter console.


10. Create a new VM using the vCenter console. Add two CD drives to this VM and select the Palette Edge installer ISO for one of them and the **ci.iso** file for the other.


11. Select other settings, such as Network, Datastore, or Folder as appropriate for your environment.


12. Power on the VM.


13. Power on the VM and monitor the VM console for log messages. The installer and user data will be copied to the hard disk, and the VM will shut down.


14. Power off the VM


15. Edit the VM settings and delete the two CD drives that were previously attached.


16. Export the VM as an OVF template.


The OVA file is ready to ship to various edge locations for installation.


## Validation

You can validate the OVA file by using the [ovftool](https://developer.vmware.com/web/tool/4.4.0/ovf) tool provided by VMware. To validate an OVA file using ovftool, follow these steps:

1. Open a terminal window.


2. Run the following command. Replace the path with the path to your OVA file.

  ```
  ovftool path/to/ova/file.ova
  ```


3. Wait for the tool to validate the OVA file. If there are any errors or warnings, they will be displayed in the terminal.


</Tabs.TabPane>

</Tabs>