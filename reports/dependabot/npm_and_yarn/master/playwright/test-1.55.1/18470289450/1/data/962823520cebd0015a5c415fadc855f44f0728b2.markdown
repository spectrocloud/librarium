# Page snapshot

```yaml
- generic [active] [ref=e1]:
  - generic [ref=e2]:
    - region "Skip to main content":
      - link "Skip to main content" [ref=e3] [cursor=pointer]:
        - /url: "#__docusaurus_skipToContent_fallback"
    - navigation "Main" [ref=e4]:
      - generic [ref=e5]:
        - generic [ref=e6]:
          - link "Spectro cloud logo" [ref=e7] [cursor=pointer]:
            - /url: /
            - img "Spectro cloud logo" [ref=e9]
          - link "Docs" [ref=e10] [cursor=pointer]:
            - /url: /release-notes/
          - link "Tutorials" [ref=e11] [cursor=pointer]:
            - /url: /tutorials/
          - link "Downloads" [ref=e12] [cursor=pointer]:
            - /url: /downloads/
          - link "API" [ref=e13] [cursor=pointer]:
            - /url: /api/introduction/
          - button "latest" [ref=e15] [cursor=pointer]
        - generic [ref=e16]:
          - link "GitHub repository" [ref=e17] [cursor=pointer]:
            - /url: https://github.com/spectrocloud/librarium
          - button "Switch between dark and light mode (currently system mode)" [ref=e19] [cursor=pointer]:
            - img [ref=e20]
          - button "Search (Ctrl+K)" [ref=e23] [cursor=pointer]:
            - generic [ref=e24]:
              - img [ref=e25]
              - generic [ref=e27]: Search
    - generic [ref=e31]:
      - complementary [ref=e32]:
        - generic [ref=e34]:
          - link "Spectro cloud logo" [ref=e35] [cursor=pointer]:
            - /url: /
            - img "Spectro cloud logo" [ref=e36]
          - navigation "Docs sidebar" [ref=e37]:
            - list [ref=e38]:
              - listitem [ref=e39]:
                - generic [ref=e40]:
                  - link "Release Notes" [ref=e41] [cursor=pointer]:
                    - /url: /release-notes/
                    - img [ref=e43]
                    - text: Release Notes
                  - button "Toggle the collapsible sidebar category 'Release Notes'" [ref=e45] [cursor=pointer]
              - listitem [ref=e46]:
                - generic [ref=e47]:
                  - link "Security Bulletins" [ref=e48] [cursor=pointer]:
                    - /url: /security-bulletins/
                    - img [ref=e50]
                    - text: Security Bulletins
                  - button "Toggle the collapsible sidebar category 'Security Bulletins'" [ref=e52] [cursor=pointer]
              - listitem [ref=e53]:
                - generic [ref=e54]:
                  - link "What is Palette?" [ref=e55] [cursor=pointer]:
                    - /url: /
                    - img [ref=e57]
                    - text: What is Palette?
                  - button "Toggle the collapsible sidebar category 'What is Palette?'" [ref=e59] [cursor=pointer]
              - listitem [ref=e60]:
                - link "Getting Started" [ref=e61] [cursor=pointer]:
                  - /url: /getting-started/
                  - img [ref=e63]
                  - text: Getting Started
              - listitem [ref=e65]:
                - generic [ref=e66]:
                  - link "Architecture" [ref=e67] [cursor=pointer]:
                    - /url: /architecture/
                    - img [ref=e69]
                    - text: Architecture
                  - button "Toggle the collapsible sidebar category 'Architecture'" [ref=e71] [cursor=pointer]
              - listitem [ref=e72]:
                - generic [ref=e73]:
                  - link "Profiles" [ref=e74] [cursor=pointer]:
                    - /url: /profiles/
                    - img [ref=e76]
                    - text: Profiles
                  - button "Toggle the collapsible sidebar category 'Profiles'" [ref=e80] [cursor=pointer]
              - listitem [ref=e81]:
                - generic [ref=e82]:
                  - link "Deployment Modes" [expanded] [ref=e83] [cursor=pointer]:
                    - /url: /deployment-modes/
                    - img [ref=e85]
                    - text: Deployment Modes
                  - button "Toggle the collapsible sidebar category 'Deployment Modes'" [ref=e87] [cursor=pointer]
                - list [ref=e88]:
                  - listitem [ref=e89]:
                    - generic [ref=e90]:
                      - link "Agent Mode" [expanded] [ref=e91] [cursor=pointer]:
                        - /url: /deployment-modes/agent-mode/
                      - button "Toggle the collapsible sidebar category 'Agent Mode'" [ref=e92] [cursor=pointer]
                    - list [ref=e93]:
                      - listitem [ref=e94]:
                        - link "Install Palette Agent" [ref=e95] [cursor=pointer]:
                          - /url: /deployment-modes/agent-mode/install-agent-host/
                      - listitem [ref=e96]:
                        - link "Configure networkd to Prepare Host for Overlay Network" [ref=e97] [cursor=pointer]:
                          - /url: /deployment-modes/agent-mode/overlay-preparation/
                      - listitem [ref=e98]:
                        - link "Architecture" [ref=e99] [cursor=pointer]:
                          - /url: /deployment-modes/agent-mode/architecture/
                      - listitem [ref=e100]:
                        - generic [ref=e101]:
                          - link "Manage Hosts in Agent Mode" [expanded] [ref=e102] [cursor=pointer]:
                            - /url: /deployment-modes/agent-mode/manage-agent/
                          - button "Toggle the collapsible sidebar category 'Manage Hosts in Agent Mode'" [ref=e103] [cursor=pointer]
                        - list [ref=e104]:
                          - listitem [ref=e105]:
                            - link "Customize Local UI Theme" [ref=e106] [cursor=pointer]:
                              - /url: /deployment-modes/agent-mode/manage-agent/localui-theming/
                          - listitem [ref=e107]:
                            - link "Configure Regularly Scheduled OS Upgrades" [ref=e108] [cursor=pointer]:
                              - /url: /deployment-modes/agent-mode/manage-agent/os-upgrades/
                  - listitem [ref=e109]:
                    - generic [ref=e110]:
                      - link "Appliance Mode" [ref=e111] [cursor=pointer]:
                        - /url: /deployment-modes/appliance-mode/
                      - button "Toggle the collapsible sidebar category 'Appliance Mode'" [ref=e112] [cursor=pointer]
                  - listitem [ref=e113]:
                    - link "Controller Mode" [ref=e114] [cursor=pointer]:
                      - /url: /deployment-modes/controller-mode/
              - listitem [ref=e115]:
                - generic [ref=e116]:
                  - link "Clusters" [ref=e117] [cursor=pointer]:
                    - /url: /clusters/
                    - img [ref=e119]
                    - text: Clusters
                  - button "Toggle the collapsible sidebar category 'Clusters'" [ref=e125] [cursor=pointer]
              - listitem [ref=e126]:
                - generic [ref=e127]:
                  - link "Bring Your Own OS (BYOOS)" [ref=e128] [cursor=pointer]:
                    - /url: /byoos/
                    - img [ref=e130]
                    - text: Bring Your Own OS (BYOOS)
                  - button "Toggle the collapsible sidebar category 'Bring Your Own OS (BYOOS)'" [ref=e132] [cursor=pointer]
              - listitem [ref=e133]:
                - generic [ref=e134]:
                  - link "Palette Dev Engine" [ref=e135] [cursor=pointer]:
                    - /url: /devx/
                    - img [ref=e137]
                    - text: Palette Dev Engine
                  - button "Toggle the collapsible sidebar category 'Palette Dev Engine'" [ref=e139] [cursor=pointer]
              - listitem [ref=e140]:
                - generic [ref=e141]:
                  - link "Virtual Machine Orchestrator" [ref=e142] [cursor=pointer]:
                    - /url: /vm-management/
                    - img [ref=e144]
                    - text: Virtual Machine Orchestrator
                  - button "Toggle the collapsible sidebar category 'Virtual Machine Orchestrator'" [ref=e146] [cursor=pointer]
              - listitem [ref=e147]:
                - generic [ref=e148]:
                  - link "Workspaces" [ref=e149] [cursor=pointer]:
                    - /url: /workspace/
                    - img [ref=e151]
                    - text: Workspaces
                  - button "Toggle the collapsible sidebar category 'Workspaces'" [ref=e153] [cursor=pointer]
              - listitem [ref=e154]:
                - generic [ref=e155]:
                  - link "Packs List" [ref=e156] [cursor=pointer]:
                    - /url: /integrations/
                    - img [ref=e158]
                    - text: Packs List
                  - button "Toggle the collapsible sidebar category 'Packs List'" [ref=e160] [cursor=pointer]
              - listitem [ref=e161]:
                - generic [ref=e162]:
                  - link "User & Role Management" [ref=e163] [cursor=pointer]:
                    - /url: /user-management/
                    - img [ref=e165]
                    - text: User & Role Management
                  - button "Toggle the collapsible sidebar category 'User & Role Management'" [ref=e167] [cursor=pointer]
              - listitem [ref=e168]:
                - generic [ref=e169]:
                  - link "Registries and Packs" [ref=e170] [cursor=pointer]:
                    - /url: /registries-and-packs/
                    - img [ref=e172]
                    - text: Registries and Packs
                  - button "Toggle the collapsible sidebar category 'Registries and Packs'" [ref=e174] [cursor=pointer]
              - listitem [ref=e175]:
                - generic [ref=e176]:
                  - link "Security" [ref=e177] [cursor=pointer]:
                    - /url: /security/
                    - img [ref=e179]
                    - text: Security
                  - button "Toggle the collapsible sidebar category 'Security'" [ref=e181] [cursor=pointer]
              - listitem [ref=e182]:
                - generic [ref=e183]:
                  - link "Audit Logs" [ref=e184] [cursor=pointer]:
                    - /url: /audit-logs/
                    - img [ref=e186]
                    - text: Audit Logs
                  - button "Toggle the collapsible sidebar category 'Audit Logs'" [ref=e188] [cursor=pointer]
              - listitem [ref=e189]:
                - generic [ref=e190]:
                  - link "Self-Hosted Palette" [ref=e191] [cursor=pointer]:
                    - /url: /enterprise-version/
                    - img [ref=e193]
                    - text: Self-Hosted Palette
                  - button "Toggle the collapsible sidebar category 'Self-Hosted Palette'" [ref=e195] [cursor=pointer]
              - listitem [ref=e196]:
                - generic [ref=e197]:
                  - link "Palette VerteX" [ref=e198] [cursor=pointer]:
                    - /url: /vertex/
                    - img [ref=e200]
                    - text: Palette VerteX
                  - button "Toggle the collapsible sidebar category 'Palette VerteX'" [ref=e202] [cursor=pointer]
              - listitem [ref=e203]:
                - generic [ref=e204]:
                  - link "Tenant Administration" [ref=e205] [cursor=pointer]:
                    - /url: /tenant-settings/
                    - img [ref=e207]
                    - text: Tenant Administration
                  - button "Toggle the collapsible sidebar category 'Tenant Administration'" [ref=e209] [cursor=pointer]
              - listitem [ref=e210]:
                - generic [ref=e211]:
                  - link "Automation" [ref=e212] [cursor=pointer]:
                    - /url: /automation/
                    - img [ref=e214]
                    - text: Automation
                  - button "Toggle the collapsible sidebar category 'Automation'" [ref=e216] [cursor=pointer]
              - listitem [ref=e217]:
                - generic [ref=e218]:
                  - link "Troubleshooting" [ref=e219] [cursor=pointer]:
                    - /url: /troubleshooting/
                    - img [ref=e221]
                    - text: Troubleshooting
                  - button "Toggle the collapsible sidebar category 'Troubleshooting'" [ref=e223] [cursor=pointer]
              - listitem [ref=e224]:
                - link "Glossary" [ref=e225] [cursor=pointer]:
                  - /url: /glossary-all/
                  - img [ref=e227]
                  - text: Glossary
              - listitem [ref=e229]:
                - generic [ref=e230]:
                  - link "Compliance & Legal" [ref=e231] [cursor=pointer]:
                    - /url: /legal-licenses/
                    - img [ref=e233]
                    - text: Compliance & Legal
                  - button "Toggle the collapsible sidebar category 'Compliance & Legal'" [ref=e235] [cursor=pointer]
              - listitem [ref=e236]:
                - button "Privacy Settings" [ref=e237] [cursor=pointer]:
                  - img [ref=e238]
                  - text: Privacy Settings
      - main [ref=e240]:
        - generic [ref=e242]:
          - generic [ref=e244]:
            - article [ref=e245]:
              - navigation "Breadcrumbs" [ref=e246]:
                - list [ref=e247]:
                  - listitem [ref=e248]:
                    - link "Home page" [ref=e249] [cursor=pointer]:
                      - /url: /
                      - img [ref=e250]
                  - listitem [ref=e252]:
                    - link "Deployment Modes" [ref=e253] [cursor=pointer]:
                      - /url: /deployment-modes/
                  - listitem [ref=e254]:
                    - link "Agent Mode" [ref=e255] [cursor=pointer]:
                      - /url: /deployment-modes/agent-mode/
                  - listitem [ref=e256]:
                    - link "Manage Hosts in Agent Mode" [ref=e257] [cursor=pointer]:
                      - /url: /deployment-modes/agent-mode/manage-agent/
                  - listitem [ref=e258]:
                    - generic [ref=e259]: Configure Regularly Scheduled OS Upgrades
              - generic [ref=e260]:
                - heading "Configure Regularly Scheduled OS Upgrades" [level=1] [ref=e262]
                - paragraph [ref=e263]: Agent mode hosts install and manage their Operating System (OS) outside Palette. This approach brings great flexibility in terms of architecture, but it has the drawback that Palette cannot upgrade, patch or manage the operating systems of the hosts. This can lead to inconsistencies, missed updates, or operational risks.
                - paragraph [ref=e264]: This page demonstrates how to configure regularly scheduled OS upgrades by leveraging cluster profiles. You will learn how to create your own Kubernetes manifest containing your custom OS upgrade script. Your cluster nodes will then be selected based on configured node labels and upgraded periodically according to a cron schedule you choose.
                - heading "PrerequisitesDirect link to Prerequisites" [level=2] [ref=e265]:
                  - text: Prerequisites
                  - link "Direct link to Prerequisites" [ref=e266] [cursor=pointer]:
                    - /url: "#prerequisites"
                    - text: "#"
                - list [ref=e267]:
                  - listitem [ref=e268]:
                    - text: A Palette cluster deployed on one or multiple hosts with the Palette Agent installed. Refer to the
                    - link "Install Agent Mode" [ref=e269] [cursor=pointer]:
                      - /url: /deployment-modes/agent-mode/install-agent-host/
                    - text: guide for further details. The cluster should be listed as
                    - strong [ref=e270]: Healthy
                    - text: and with a
                    - strong [ref=e271]: Running
                    - text: status.
                    - list [ref=e272]:
                      - listitem [ref=e273]: The host must have access to the internet and a connection to Palette.
                  - listitem [ref=e274]: Access to a terminal with network access to your cluster.
                  - listitem [ref=e275]:
                    - text: Kubectl installed locally. Refer to the Kubernetes
                    - link "Install Tools" [ref=e276] [cursor=pointer]:
                      - /url: https://kubernetes.io/docs/tasks/tools/
                    - text: guide for further details.
                - heading "EnablementDirect link to Enablement" [level=2] [ref=e277]:
                  - text: Enablement
                  - link "Direct link to Enablement" [ref=e278] [cursor=pointer]:
                    - /url: "#enablement"
                    - text: "#"
                - list [ref=e279]:
                  - listitem [ref=e280]:
                    - paragraph [ref=e281]:
                      - text: Log in to
                      - link "Palette" [ref=e282] [cursor=pointer]:
                        - /url: https://console.spectrocloud.com
                      - text: .
                  - listitem [ref=e283]:
                    - paragraph [ref=e284]:
                      - text: Navigate to the left main menu and select
                      - strong [ref=e285]: Clusters
                      - text: .
                  - listitem [ref=e286]:
                    - paragraph [ref=e287]: Select your cluster to access the cluster details page.
                  - listitem [ref=e288]:
                    - paragraph [ref=e289]:
                      - text: Download the
                      - strong [ref=e290]: kubeconfig
                      - text: file for your cluster. Open a terminal and navigate to the location of the file.
                  - listitem [ref=e291]:
                    - paragraph [ref=e292]:
                      - text: Set the
                      - code [ref=e293]: KUBECONFIG
                      - text: environment variable to the file path of the
                      - strong [ref=e294]: kubeconfig
                      - text: file to enable you to connect to the cluster using
                      - link "kubectl CLI" [ref=e295] [cursor=pointer]:
                        - /url: https://kubernetes.io/docs/reference/kubectl/
                      - text: . Refer to the
                      - link "Access Cluster with CLI" [ref=e296] [cursor=pointer]:
                        - /url: /clusters/cluster-management/palette-webctl/#access-cluster-with-cli
                      - text: section for further guidance.
                    - generic [ref=e298]:
                      - code [ref=e300]:
                        - generic [ref=e301]: export KUBECONFIG=/path/to/your/kubeconfig
                      - button "Copy code to clipboard" [ref=e303] [cursor=pointer]:
                        - generic [ref=e304]:
                          - img [ref=e305]
                          - img [ref=e307]
                  - listitem [ref=e309]:
                    - paragraph [ref=e310]:
                      - text: Execute the following commands to find the
                      - code [ref=e311]: spectro-task-XXX
                      - text: namespace of your cluster and save it to the
                      - code [ref=e312]: SYSTEM_UPGRADE_NAMESPACE
                      - text: variable. This namespace will be different between clusters.
                    - generic [ref=e314]:
                      - code [ref=e316]:
                        - generic [ref=e317]: export SYSTEM_UPGRADE_NAMESPACE=$(kubectl get namespaces --no-headers --output custom-columns=":metadata.name" | grep '^spectro-task')
                        - generic [ref=e318]: echo $SYSTEM_UPGRADE_NAMESPACE
                      - generic [ref=e319]:
                        - button "Toggle word wrap" [ref=e320] [cursor=pointer]:
                          - img [ref=e321]
                        - button "Copy code to clipboard" [ref=e323] [cursor=pointer]:
                          - generic [ref=e324]:
                            - img [ref=e325]
                            - img [ref=e327]
                    - paragraph [ref=e329]: The output will be similar to the following snippet.
                    - code [ref=e333]:
                      - generic [ref=e334]: spectro-task-6851ddd04b1b188784c06291
                  - listitem [ref=e335]:
                    - paragraph [ref=e336]:
                      - text: Provide an upgrade frequency using a cron format. This is used to configure a Kubernetes
                      - link "CronJob" [ref=e337] [cursor=pointer]:
                        - /url: https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/
                      - text: to execute upgrades on a repeating schedule. You can find some common examples of cron schedules in the following table.
                    - table [ref=e338]:
                      - rowgroup [ref=e339]:
                        - row "Expression Description" [ref=e340]:
                          - cell "Expression" [ref=e341]:
                            - strong [ref=e342]: Expression
                          - cell "Description" [ref=e343]:
                            - strong [ref=e344]: Description
                      - rowgroup [ref=e345]:
                        - row "0 0 1 1 * Once a year at midnight of 1 January" [ref=e346]:
                          - cell "0 0 1 1 *" [ref=e347]:
                            - code [ref=e348]: 0 0 1 1 *
                          - cell "Once a year at midnight of 1 January" [ref=e349]
                        - row "0 0 1 * * Once a month at midnight of the first day of the month" [ref=e350]:
                          - cell "0 0 1 * *" [ref=e351]:
                            - code [ref=e352]: 0 0 1 * *
                          - cell "Once a month at midnight of the first day of the month" [ref=e353]
                        - row "0 0 * * 0 Once a week at midnight on Sunday morning" [ref=e354]:
                          - cell "0 0 * * 0" [ref=e355]:
                            - code [ref=e356]: 0 0 * * 0
                          - cell "Once a week at midnight on Sunday morning" [ref=e357]
                        - row "0 0 * * * Once a day at midnight" [ref=e358]:
                          - cell "0 0 * * *" [ref=e359]:
                            - code [ref=e360]: 0 0 * * *
                          - cell "Once a day at midnight" [ref=e361]
                        - row "0 * * * * Once an hour at the beginning of the hour" [ref=e362]:
                          - cell "0 * * * *" [ref=e363]:
                            - code [ref=e364]: 0 * * * *
                          - cell "Once an hour at the beginning of the hour" [ref=e365]
                    - paragraph [ref=e366]:
                      - text: Execute the following command in your terminal, replacing the placeholder with your preferred cron schedule. The command saves your chosen schedule to the
                      - code [ref=e367]: SYSTEM_UPGRADE_SCHEDULE
                      - text: variable.
                    - generic [ref=e369]:
                      - code [ref=e371]:
                        - generic [ref=e372]: export SYSTEM_UPGRADE_SCHEDULE="REPLACE ME"
                      - button "Copy code to clipboard" [ref=e374] [cursor=pointer]:
                        - generic [ref=e375]:
                          - img [ref=e376]
                          - img [ref=e378]
                  - listitem [ref=e380]:
                    - paragraph [ref=e381]:
                      - text: Execute the following command in your terminal, replacing the placeholder with a node label of your choice. This variable allows you to customize which nodes should be periodically updated. The command saves your label to the
                      - code [ref=e382]: SYSTEM_UPGRADE_NODE_LABEL
                      - text: variable.
                    - generic [ref=e384]:
                      - code [ref=e386]:
                        - generic [ref=e387]: export SYSTEM_UPGRADE_NODE_LABEL="REPLACE ME"
                      - button "Copy code to clipboard" [ref=e389] [cursor=pointer]:
                        - generic [ref=e390]:
                          - img [ref=e391]
                          - img [ref=e393]
                  - listitem [ref=e395]:
                    - paragraph [ref=e396]: Apply the node label to all the nodes that you want updated. Execute the command by replacing the placeholder with the name of the node. Repeat this step for each node you want to upgrade.
                    - generic [ref=e398]:
                      - code [ref=e400]:
                        - generic [ref=e401]: kubectl label node REPLACE-ME $SYSTEM_UPGRADE_NODE_LABEL=
                      - button "Copy code to clipboard" [ref=e403] [cursor=pointer]:
                        - generic [ref=e404]:
                          - img [ref=e405]
                          - img [ref=e407]
                    - generic [ref=e409]:
                      - generic [ref=e410]:
                        - img [ref=e412]
                        - text: info
                      - paragraph [ref=e415]: Nodes are drained, upgraded, and rebooted one by one. Ensure that your cluster has enough resources to perform rolling upgrades in order to avoid outages.
                  - listitem [ref=e416]:
                    - paragraph [ref=e417]:
                      - text: Save your upgrade scripts to a file titled
                      - code [ref=e418]: upgrades.sh
                      - text: . You can provide any instructions that you want to execute on system upgrade and reboot. The following example provides upgrade instructions for Ubuntu, but you can modify them to work according to your host operating system. The command creates the
                      - code [ref=e419]: upgrades.sh
                      - text: file in your local directory.
                    - generic [ref=e421]:
                      - code [ref=e423]:
                        - generic [ref=e424]: cat << 'EOF' > upgrades.sh
                        - generic [ref=e425]: "#!/bin/sh"
                        - generic [ref=e426]: set -e
                        - generic [ref=e427]: secrets=$(dirname "$0")
                        - generic [ref=e428]: export DEBIAN_FRONTEND=noninteractive
                        - generic [ref=e429]: apt-get --assume-yes update
                        - generic [ref=e430]: apt-get -o Dpkg::Options::="--force-confold" dist-upgrade -q -y --force-yes
                        - generic [ref=e431]: EOF
                      - generic [ref=e432]:
                        - button "Toggle word wrap" [ref=e433] [cursor=pointer]:
                          - img [ref=e434]
                        - button "Copy code to clipboard" [ref=e436] [cursor=pointer]:
                          - generic [ref=e437]:
                            - img [ref=e438]
                            - img [ref=e440]
                  - listitem [ref=e442]:
                    - paragraph [ref=e443]:
                      - text: Execute the following commands to create the
                      - code [ref=e444]: upgrades.yaml
                      - text: file using your namespace, upgrade schedule, labels, and upgrade script variables.
                    - generic [ref=e446]:
                      - code [ref=e448]:
                        - generic [ref=e449]: cat << EOF > upgrades.yaml
                        - generic [ref=e450]: "---"
                        - generic [ref=e451]: "apiVersion: v1"
                        - generic [ref=e452]: "kind: Secret"
                        - generic [ref=e453]: "metadata:"
                        - generic [ref=e454]: "name: os-upgrade-script"
                        - generic [ref=e455]: "namespace: $SYSTEM_UPGRADE_NAMESPACE"
                        - generic [ref=e456]: "type: Opaque"
                        - generic [ref=e457]: "stringData:"
                        - generic [ref=e458]: "upgrade.sh: |"
                        - generic [ref=e459]: $(sed 's/^/ /' upgrades.sh)
                        - generic [ref=e460]: "---"
                        - generic [ref=e461]: "apiVersion: v1"
                        - generic [ref=e462]: "kind: Secret"
                        - generic [ref=e463]: "metadata:"
                        - generic [ref=e464]: "name: os-upgrade-plan"
                        - generic [ref=e465]: "namespace: $SYSTEM_UPGRADE_NAMESPACE"
                        - generic [ref=e466]: "type: Opaque"
                        - generic [ref=e467]: "stringData:"
                        - generic [ref=e468]: "plan.yaml: |"
                        - generic [ref=e469]: "apiVersion: cluster.spectrocloud.com/v1alpha1"
                        - generic [ref=e470]: "kind: SpectroSystemTask"
                        - generic [ref=e471]: "metadata:"
                        - generic [ref=e472]: "name: os-upgrade-plan"
                        - generic [ref=e473]: "namespace: $SYSTEM_UPGRADE_NAMESPACE"
                        - generic [ref=e474]: "spec:"
                        - generic [ref=e475]: "concurrency: 1"
                        - generic [ref=e476]: "nodeSelector:"
                        - generic [ref=e477]: "matchExpressions:"
                        - generic [ref=e478]: "- { key: $SYSTEM_UPGRADE_NODE_LABEL, operator: Exists }"
                        - generic [ref=e479]: "serviceAccountName: spectro-task"
                        - generic [ref=e480]: "secrets:"
                        - generic [ref=e481]: "- name: os-upgrade-script"
                        - generic [ref=e482]: "path: /host/run/spectro-task/secrets/bionic"
                        - generic [ref=e483]: "tolerations:"
                        - generic [ref=e484]: "- key: node-role.kubernetes.io/master"
                        - generic [ref=e485]: "operator: Exists"
                        - generic [ref=e486]: "effect: NoSchedule"
                        - generic [ref=e487]: "- key: node-role.kubernetes.io/controlplane"
                        - generic [ref=e488]: "operator: Exists"
                        - generic [ref=e489]: "effect: NoSchedule"
                        - generic [ref=e490]: "drain:"
                        - generic [ref=e491]: "force: true"
                        - generic [ref=e492]: "version: bionic"
                        - generic [ref=e493]: "task:"
                        - generic [ref=e494]: "image: us-docker.pkg.dev/palette-images/third-party/ubuntu:22.04"
                        - generic [ref=e495]: "command: [\"chroot\", \"/host\"]"
                        - generic [ref=e496]: "args: [\"sh\", \"/run/spectro-task/secrets/bionic/upgrade.sh\"]"
                        - generic [ref=e497]: "---"
                        - generic [ref=e498]: "apiVersion: batch/v1"
                        - generic [ref=e499]: "kind: CronJob"
                        - generic [ref=e500]: "metadata:"
                        - generic [ref=e501]: "name: os-upgrade-cronjob"
                        - generic [ref=e502]: "namespace: $SYSTEM_UPGRADE_NAMESPACE"
                        - generic [ref=e503]: "spec:"
                        - generic [ref=e504]: "schedule: \"$SYSTEM_UPGRADE_SCHEDULE\""
                        - generic [ref=e505]: "jobTemplate:"
                        - generic [ref=e506]: "spec:"
                        - generic [ref=e507]: "template:"
                        - generic [ref=e508]: "spec:"
                        - generic [ref=e509]: "serviceAccountName: spectro-task"
                        - generic [ref=e510]: "containers:"
                        - generic [ref=e511]: "- name: os-upgrade-job"
                        - generic [ref=e512]: "image: us-docker.pkg.dev/palette-images/third-party/ubuntu:22.04"
                        - generic [ref=e513]: "command:"
                        - generic [ref=e514]: "- sh"
                        - generic [ref=e515]: "- -c"
                        - generic [ref=e516]: "- |"
                        - generic [ref=e517]: apt-get update
                        - generic [ref=e518]: apt-get install -y curl
                        - generic [ref=e519]: curl -LO "https://dl.k8s.io/release/\$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
                        - generic [ref=e520]: chmod +x kubectl
                        - generic [ref=e521]: mv kubectl /usr/local/bin/
                        - generic [ref=e522]: export KUBECONFIG=/run/kubeconfig
                        - generic [ref=e523]: kubectl get plan os-upgrade-plan --namespace $SYSTEM_UPGRADE_NAMESPACE
                        - generic [ref=e524]: if [ \$? -eq 0 ]; then
                        - generic [ref=e525]: echo "Upgrade plan exists. Retrigger it."
                        - generic [ref=e526]: VERSION="os-upgrade-plan-\$(date +%Y%m%d%H%M%S)"
                        - generic [ref=e527]: "kubectl patch plan os-upgrade-plan --namespace $SYSTEM_UPGRADE_NAMESPACE --type=json --patch=\"[{\\\"op\\\": \\\"replace\\\", \\\"path\\\": \\\"/spec/version\\\", \\\"value\\\": \\\"\\${VERSION}\\\"}]\""
                        - generic [ref=e528]: else
                        - generic [ref=e529]: echo "Upgrade plan does not exist. Create it."
                        - generic [ref=e530]: "kubectl get secret os-upgrade-plan --namespace $SYSTEM_UPGRADE_NAMESPACE --output go-template='{{ index .data \"plan.yaml\" | base64decode }}' | kubectl apply --filename -"
                        - generic [ref=e531]: fi
                        - generic [ref=e532]: "restartPolicy: OnFailure"
                        - generic [ref=e533]: EOF
                      - generic [ref=e534]:
                        - button "Toggle word wrap" [ref=e535] [cursor=pointer]:
                          - img [ref=e536]
                        - button "Copy code to clipboard" [ref=e538] [cursor=pointer]:
                          - generic [ref=e539]:
                            - img [ref=e540]
                            - img [ref=e542]
                    - paragraph [ref=e544]:
                      - text: The command creates the
                      - code [ref=e545]: upgrades.yaml
                      - text: file in your current directory. The YAML file defines the following Kubernetes resources.
                    - table [ref=e546]:
                      - rowgroup [ref=e547]:
                        - row "Resource Name Description" [ref=e548]:
                          - cell "Resource" [ref=e549]:
                            - strong [ref=e550]: Resource
                          - cell "Name" [ref=e551]:
                            - strong [ref=e552]: Name
                          - cell "Description" [ref=e553]:
                            - strong [ref=e554]: Description
                      - rowgroup [ref=e555]:
                        - row "Secret os-upgrade-script Stores the upgrade.sh shell script, which defines the upgrade logic to be executed on target nodes. This script is later mounted into the container via a secret volume." [ref=e556]:
                          - cell "Secret" [ref=e557]:
                            - code [ref=e558]: Secret
                          - cell "os-upgrade-script" [ref=e559]:
                            - code [ref=e560]: os-upgrade-script
                          - cell "Stores the upgrade.sh shell script, which defines the upgrade logic to be executed on target nodes. This script is later mounted into the container via a secret volume." [ref=e561]:
                            - text: Stores the
                            - code [ref=e562]: upgrade.sh
                            - text: shell script, which defines the upgrade logic to be executed on target nodes. This script is later mounted into the container via a secret volume.
                        - row "Secret os-upgrade-plan Stores the YAML definition of a SpectroSystemTask resource in its plan.yaml field. The CronJob retrieves this secret and applies the embedded plan to initiate the upgrade process." [ref=e563]:
                          - cell "Secret" [ref=e564]:
                            - code [ref=e565]: Secret
                          - cell "os-upgrade-plan" [ref=e566]:
                            - code [ref=e567]: os-upgrade-plan
                          - cell "Stores the YAML definition of a SpectroSystemTask resource in its plan.yaml field. The CronJob retrieves this secret and applies the embedded plan to initiate the upgrade process." [ref=e568]:
                            - text: Stores the YAML definition of a
                            - code [ref=e569]: SpectroSystemTask
                            - text: resource in its
                            - code [ref=e570]: plan.yaml
                            - text: field. The CronJob retrieves this secret and applies the embedded plan to initiate the upgrade process.
                        - row "CronJob os-upgrade-job Schedules the upgrade plan to execute at regular intervals and provides a restart policy should the plan fail." [ref=e571]:
                          - cell "CronJob" [ref=e572]:
                            - code [ref=e573]: CronJob
                          - cell "os-upgrade-job" [ref=e574]:
                            - code [ref=e575]: os-upgrade-job
                          - cell "Schedules the upgrade plan to execute at regular intervals and provides a restart policy should the plan fail." [ref=e576]
                  - listitem [ref=e577]:
                    - paragraph [ref=e578]:
                      - text: Navigate back to
                      - link "Palette" [ref=e579] [cursor=pointer]:
                        - /url: https://console.spectrocloud.com
                      - text: in your browser. Select
                      - strong [ref=e580]: Profiles
                      - text: from the left main menu.
                  - listitem [ref=e581]:
                    - paragraph [ref=e582]: Select the cluster profile corresponding to your agent mode cluster.
                  - listitem [ref=e583]:
                    - paragraph [ref=e584]:
                      - text: Click on the version drop-down menu. Select the
                      - strong [ref=e585]: Create new version
                      - text: option. Fill in the
                      - strong [ref=e586]: Version
                      - text: input and click
                      - strong [ref=e587]: Confirm
                      - text: to create a new version of your cluster profile. The new profile version opens.
                  - listitem [ref=e588]:
                    - paragraph [ref=e589]:
                      - text: Click
                      - strong [ref=e590]: Add manifest
                      - text: . The manifest editor appears. Fill in the
                      - strong [ref=e591]: Layer name
                      - text: input field. Then, click
                      - strong [ref=e592]: New Manifest
                      - text: . Input a name for the manifest file. Click on the check or press Enter to open the editor.
                  - listitem [ref=e593]:
                    - paragraph [ref=e594]:
                      - text: Paste the contents of the
                      - code [ref=e595]: upgrades.yaml
                      - text: file that you have created in
                      - strong [ref=e596]: Step 11
                      - text: . Click
                      - strong [ref=e597]: Confirm Updates
                      - text: to save your manifest. Then, click
                      - strong [ref=e598]: Save Changes
                      - text: to save your manifest to the cluster profile.
                  - listitem [ref=e599]:
                    - paragraph [ref=e600]:
                      - text: Navigate to the left main menu and select
                      - strong [ref=e601]: Clusters
                      - text: .
                  - listitem [ref=e602]:
                    - paragraph [ref=e603]: Select your cluster to access the cluster details page.
                  - listitem [ref=e604]:
                    - paragraph [ref=e605]:
                      - text: Click on the
                      - strong [ref=e606]: Profiles
                      - text: tab.
                  - listitem [ref=e607]:
                    - paragraph [ref=e608]:
                      - text: Select the newly created version of your cluster profile. Click
                      - strong [ref=e609]: Save
                      - text: .
                - paragraph [ref=e610]:
                  - text: Palette applies your manifest to the cluster. The Kubernetes resources responsible for the system upgrade are created in the
                  - code [ref=e611]: spectro-task-xxx
                  - text: namespace.
                - heading "ValidateDirect link to Validate" [level=2] [ref=e612]:
                  - text: Validate
                  - link "Direct link to Validate" [ref=e613] [cursor=pointer]:
                    - /url: "#validate"
                    - text: "#"
                - list [ref=e614]:
                  - listitem [ref=e615]:
                    - paragraph [ref=e616]:
                      - text: Log in to
                      - link "Palette" [ref=e617] [cursor=pointer]:
                        - /url: https://console.spectrocloud.com
                      - text: .
                  - listitem [ref=e618]:
                    - paragraph [ref=e619]:
                      - text: Navigate to the left main menu and select
                      - strong [ref=e620]: Clusters
                      - text: .
                  - listitem [ref=e621]:
                    - paragraph [ref=e622]: Select your cluster to access the cluster details page.
                  - listitem [ref=e623]:
                    - paragraph [ref=e624]:
                      - text: Download the
                      - strong [ref=e625]: kubeconfig
                      - text: file for your cluster. Open a terminal and navigate to the location of the file.
                  - listitem [ref=e626]:
                    - paragraph [ref=e627]:
                      - text: Set the
                      - code [ref=e628]: KUBECONFIG
                      - text: environment variable to the file path of the
                      - strong [ref=e629]: kubeconfig
                      - text: file to enable you to connect to it using
                      - link "kubectl CLI" [ref=e630] [cursor=pointer]:
                        - /url: https://kubernetes.io/docs/reference/kubectl/
                      - text: . Refer to the
                      - link "Access Cluster with CLI" [ref=e631] [cursor=pointer]:
                        - /url: /clusters/cluster-management/palette-webctl/#access-cluster-with-cli
                      - text: section for further guidance.
                    - generic [ref=e633]:
                      - code [ref=e635]:
                        - generic [ref=e636]: export KUBECONFIG=/path/to/your/kubeconfig
                      - button "Copy code to clipboard" [ref=e638] [cursor=pointer]:
                        - generic [ref=e639]:
                          - img [ref=e640]
                          - img [ref=e642]
                  - listitem [ref=e644]:
                    - paragraph [ref=e645]:
                      - text: Execute the following commands to find the
                      - code [ref=e646]: spectro-task-XXX
                      - text: namespace of your cluster and save it to the
                      - code [ref=e647]: SYSTEM_UPGRADE_NAMESPACE
                      - text: variable. This namespace will be different between clusters.
                    - generic [ref=e649]:
                      - code [ref=e651]:
                        - generic [ref=e652]: export SYSTEM_UPGRADE_NAMESPACE=$(kubectl get namespaces --no-headers --output custom-columns=":metadata.name" | grep '^spectro-task')
                        - generic [ref=e653]: echo $SYSTEM_UPGRADE_NAMESPACE
                      - generic [ref=e654]:
                        - button "Toggle word wrap" [ref=e655] [cursor=pointer]:
                          - img [ref=e656]
                        - button "Copy code to clipboard" [ref=e658] [cursor=pointer]:
                          - generic [ref=e659]:
                            - img [ref=e660]
                            - img [ref=e662]
                    - paragraph [ref=e664]: The output will be similar to the following snippet.
                    - code [ref=e668]:
                      - generic [ref=e669]: spectro-task-6851ddd04b1b188784c06291
                  - listitem [ref=e670]:
                    - paragraph [ref=e671]:
                      - text: Issue the following command to retrieve a list of secrets and cronjobs under the
                      - code [ref=e672]: spectro-task-xxxxx
                      - text: namespace.
                    - generic [ref=e674]:
                      - code [ref=e676]:
                        - generic [ref=e677]: kubectl get secret,cronjob --namespace $SYSTEM_UPGRADE_NAMESPACE
                      - generic [ref=e678]:
                        - button "Toggle word wrap" [ref=e679] [cursor=pointer]:
                          - img [ref=e680]
                        - button "Copy code to clipboard" [ref=e682] [cursor=pointer]:
                          - generic [ref=e683]:
                            - img [ref=e684]
                            - img [ref=e686]
                    - paragraph [ref=e688]:
                      - text: Confirm the secrets
                      - code [ref=e689]: secret/os-upgrade-plan
                      - text: ","
                      - code [ref=e690]: secret/os-upgrade-script
                      - text: and the
                      - code [ref=e691]: cronjob.batch/os-upgrade-cronjob
                      - text: cron job were created successfully.
                    - generic [ref=e692]:
                      - generic [ref=e693]: Example Output
                      - generic [ref=e694]:
                        - code [ref=e696]:
                          - generic [ref=e697]: NAME TYPE DATA AGE
                          - generic [ref=e698]: secret/cert-renewal-script Opaque 1 41m
                          - generic [ref=e699]: secret/ntp-update-config Opaque 1 42m
                          - generic [ref=e700]: secret/ntp-update-script Opaque 1 42m
                          - generic [ref=e701]: secret/os-upgrade-plan Opaque 1 10m
                          - generic [ref=e702]: secret/os-upgrade-script Opaque 1 10m
                          - generic [ref=e703]: secret/sshkeys-update-script Opaque 1 41m
                          - generic [ref=e704]: secret/stylus-upgrade Opaque 1 41m
                          - generic [ref=e705]: NAME SCHEDULE TIMEZONE SUSPEND ACTIVE LAST SCHEDULE AGE
                          - generic [ref=e706]: cronjob.batch/os-upgrade-cronjob 0 * * * * <none> False 0 <none> 10m
                        - generic [ref=e707]:
                          - button "Toggle word wrap" [ref=e708] [cursor=pointer]:
                            - img [ref=e709]
                          - button "Copy code to clipboard" [ref=e711] [cursor=pointer]:
                            - generic [ref=e712]:
                              - img [ref=e713]
                              - img [ref=e715]
              - generic [ref=e717]:
                - generic [ref=e719]:
                  - text: "Tags:"
                  - list [ref=e720]:
                    - listitem [ref=e721]:
                      - link "edge" [ref=e722] [cursor=pointer]:
                        - /url: /tags/edge/
                - link "Edit this page" [ref=e725] [cursor=pointer]:
                  - /url: https://github.com/spectrocloud/librarium/blob/master/docs/docs-content/deployment-modes/agent-mode/manage-agent/os-upgrades.md
                  - img [ref=e726]
                  - text: Edit this page
            - navigation "Docs pages" [ref=e730]:
              - link "Previous « Customize Local UI Theme" [ref=e731] [cursor=pointer]:
                - /url: /deployment-modes/agent-mode/manage-agent/localui-theming/
                - generic [ref=e732]: Previous
                - generic [ref=e733]: « Customize Local UI Theme
              - link "Next Appliance Mode »" [ref=e734] [cursor=pointer]:
                - /url: /deployment-modes/appliance-mode/
                - generic [ref=e735]: Next
                - generic [ref=e736]: Appliance Mode »
          - list [ref=e739]:
            - listitem [ref=e740]:
              - link "Prerequisites" [ref=e741] [cursor=pointer]:
                - /url: "#prerequisites"
            - listitem [ref=e742]:
              - link "Enablement" [ref=e743] [cursor=pointer]:
                - /url: "#enablement"
            - listitem [ref=e744]:
              - link "Validate" [ref=e745] [cursor=pointer]:
                - /url: "#validate"
  - button "Project Logo Ask AI" [ref=e746] [cursor=pointer]:
    - generic [ref=e749]:
      - img "Project Logo" [ref=e750]
      - paragraph [ref=e751]: Ask AI
```